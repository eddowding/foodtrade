{% extends 'tbase.html' %}
{% load staticfiles %}
{% load activity_tags %}
{% block content %}
 
 

<div class="container-responsive block-center">


    <div class="col-md-5 col-sm-5 {% if not user.is_authenticated %} col-md-offset-1 col-sm-offset-1 {% endif %}" id="activity_switcher">
 
      <div id="update-small" class="well well-sm clearfix">
        <input class="form-control col-xs-12"  {% if not user.is_authenticated %}  onfocus="login_redirect()" title="Please login to use this feature." {% else %} onfocus= "switch_text_area()"{% endif %} placeholder="What #food do you have to #buy, #sell, or #surplus?">  
      </div> 

      <div id="update-big" class="well well-sm clearfix hidden">
        <form class="form-horizontal">
          <div class="row">
            <div class="col-xs-12">
              <textarea class="form-control col-xs-12 counted" onkeyup="check_limit()" rows="3" name="q" id="newstatus" {% if not user.is_authenticated %}  onfocus="login_redirect()" title="Please login to use this feature." {% endif %} placeholder="What would you like? Eg '300kg #surplus conference #pears for #sale or #surplus' or 'I want to  #buy organic #honey for my farm shop.' "></textarea>
            </div>
          </div>

          <div class="row" style="margin-top: 5px;">
            <div class="col-xs-7">
              <ul class="list-inline small" style="margin-bottom:0;">
                <li class="text-muted">Also send to </li>
                <li> 
                  <label>
                    <input type="checkbox" name="post_to_twitter" value="1" checked="checked" disabled>
                    <i class="fa fa-twitter-square fa-lg text-muted"></i>
                  </label>
                </li>
                <li> 
                  <label rel="tooltip" title="Post to Facebook, coming soon!">
                    <input type="checkbox" name="post_to_facebook" value="1" disabled > 
                    <i class="fa fa-facebook-square fa-lg text-muted"></i>
                  </label>
                </li>
                <li> 
                  <label rel="tooltip" title="Follower newsletters, coming soon!">
                    <input type="checkbox" name="post_to_newsletter" value="1" disabled> 
                    <i class="fa fa-list-alt fa-lg text-muted"></i> 
                  </label>
                </li> 
              </ul> 
            </div>
            <div class="col-xs-5 text-right">
              <span class="small text-muted counted" id="charsRem">
                120 characters remaining
              </span>
            </div>
          </div>


              <button type="button" id="btn_update_activity" class="btn btn-sm btn-success pull-right" {% if not user.is_authenticated %}  title="Please login to use this feature." {% endif %} onclick="UpdateActivity('newstatus');"> Post</button>
          </form>

          
         
  
  </div> 
 
<ul class="nav nav-tabs">
  <li {% if results_updates_count != 0  or results_business_count == 0 and results_organisation_count == 0  %}class="active"{% endif %}>
    <a href="#near_me" data-toggle="tab">Updates 
      <span class="badge" id="update_count">{{results_updates_count}}</span>
    </a>
  </li >
  <li {% if results_updates_count == 0  and results_organisation_count == 0 and results_business_count != 0 %}class="active"{% endif %}>
    <a href="#biz" data-toggle="tab">Business 
    <span class="badge" id="business_count">{{results_business_count}}</span>
    </a>
  </li> 

    <li {% if results_updates_count == 0 and results_business_count == 0 and results_organisation_count != 0 %}class="active"{% endif %}>
    <a href="#org" data-toggle="tab">Orgs
    <span class="badge" id="organisation_count">{{results_organisation_count}}</span>
    </a>
  </li> 
</ul>

<div class="tab-content" id = "filtered_content">
  <div class="tab-pane active" id="near_me">
 
   <div id="sortby" class="clearfix">

      <div class="btn-group pull-right">
        <span class="pull-left" style="position: relative; top: 5px; margin-right: 5px;">Sort by </span>
        <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
          <span  id="current_sort_text"><i class="fa fa-clock-o fa-fw"></i> Time posted</span>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li><a onclick="sort_by('distance')"><i class="fa fa-location-arrow fa-fw"></i> Distance from {% if search %} {{ search.place }} {% endif %} {% if not search %} {{userinfo.zip_code}}{% endif %}</a></li>
          <li><a onclick="sort_by('time')"><i class="fa fa-clock-o fa-fw"></i> Time posted</a></li>
        </ul>
      </div> 

   </div>





  <div class="activity" id="activity_updates"> 
{% if results_updates_count == 0 and results_business_count == 0 and results_organisation_count == 0 %}
<div class="alert alert-warning text-center">
  <p><strong>Sorry, we've found nothing for this search... yet!</strong></p>
  <p>More produce, businesses, and organisations are signing up every day so check back soon.</p>
</div>
{% endif %}

        <ul class="chat">

 

{% if results %}

{% for result in results %}
{% if result.user.username == result.result_type %}

{% single_activity userinfo result "status" "main" %}




     <li>
      <ul>
      {% for reply_result in result.replies %}

{% single_activity userinfo reply_result "status" "main" %}

         {% endfor %}
        
</ul>
</li>

{% endif %}
  {% endfor %}
    {% endif %}
</ul> 
  </div>

</div><!-- tab pane activity -->




  <div class="tab-pane" id="biz">
 
  <div class="activity" id="activity_biz"> 
  {% if results_updates_count == 0 and results_business_count == 0 and results_organisation_count == 0 %}
<div class="alert alert-warning text-center">
  <p><strong>Sorry, we've found nothing for this search... yet!</strong></p>
  <p>More produce, businesses, and organisations are signing up every day so check back soon.</p>
</div>
{% endif %}
        <ul class="chat">

 

{% if results %}

{% for result in results %}
{% if result.user.username != result.result_type and result.sign_up_as == "Business" %}
{% single_activity userinfo result "profile" "main" %}
    
    {% endif %}
  {% endfor %}
    {% endif %}
</ul> 
  </div>


  </div> 



  <div class="tab-pane" id="org">
 
  <div class="activity" id="activity_org"> 
  {% if results_updates_count == 0 and results_business_count == 0 and results_organisation_count == 0 %}
<div class="alert alert-warning text-center">
  <p><strong>Sorry, we've found nothing for this search... yet!</strong></p>
  <p>More produce, businesses, and organisations are signing up every day so check back soon.</p>
</div>
{% endif %}
        <ul class="chat">
{% if results %}

{% for result in results %}
{% if result.user.username != result.result_type and result.sign_up_as == "Organisation" %}
{% single_activity userinfo result "profile" "main" %}
    {% endif %}
  {% endfor %}
    {% endif %}
</ul> 
  </div>


  </div> 
  <!-- close organisation tab -->



</div><!-- tabs -->


     
    </div><!-- closes 5 -->

    <div class="col-md-5  col-sm-5 fill"  style="height: 1000px; ">

    <!-- FIX THE MAP POSITION SO IT DOES NOT SCROLL --> 
      <div id="map" >
        

        <div class="alert alert-warning"> 

          <p>There are radius lines at 15, 30, and 100 miles.</p>
        </div>

      </div>
    </div>
    <script type="text/javascript">
    map_lat={{ search.lat }};
    map_lon = {{ search.lon }};


{% if results %}
connections = {{json_data | safe}};
    {% endif %}
      food_filters = {{foods_filter |safe}};
      business_filters = {{business_filter |safe}};
      organisation_filters = {{organisation_filter |safe}};
    </script>
     <script src="{% static "js/activity-map.js" %}"></script>

  {% endblock %}


          {% block footer %}
           <script src="{% static "js/activity.js" %}"></script>

 {% endblock %}