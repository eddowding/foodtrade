{% extends 'tbase.html' %}
{% load staticfiles %}
{% load activity_tags %}
{% block head %}

{% endblock %}
{% block content %}

<div class="container-responsive block-center">

<div class="row row-merge">

<div class="col-xs-12 col-sm-4" id="activity_switcher" >


 
<div class="widget hidden" style="width:100%;">
  <div class="padding-none"> 
    <div class="input-group"  style="width:100%;">
    {% comment %}
      <textarea class="form-control"  {% if not user.is_authenticated %}  onfocus="login_redirect()" title="Please login to use this feature." {% else %} {% if not can_tweet %} data-toggle="modal" data-target="#newtwitterpost" {% else %} rel="tooltip" title="Please upgrade your account to post." {% endif %}{% endif %} style="width:100%;">What #food do you have to #buy, #sell, or #surplus?  </textarea> 
    {% endcomment %}
      <textarea class="form-control"  {% if not user.is_authenticated %}  onfocus="login_redirect()" title="Please login to use this feature." {% else %}  data-toggle="modal" data-target="#newtwitterpost" {% endif %} style="width:100%;">What #food do you have to #buy, #sell, or #surplus?  </textarea> 
    </div>
  </div>
</div>


 
<div class="container-responsive" id="searchfilters">

<div class="widget widget-tabs widget-tabs-double widget-tabs-responsive" style="background: #F5F8FA;   margin: 0 !important; padding-top: 10px;">
  <!-- Tabs Heading -->
  <div class="widget-head  "  id="result_tabs" style="background: #F2F6F8;">
    <ul> 
      <li class="active " style="">
        <a href="#mktplace" class="glyphicons bullhorn" id="mkt_tab" data-toggle="tab"><i></i><span class="strong">Market place</span><span>Real-time trading</span></a>
      </li>
      <li class="" style="">
        <a href="#profiles" class="glyphicons shop" id="profile_tab" data-toggle="tab"><i></i><span class="strong">Profiles</span><span class="dotdotdot">People &amp; places</span></a>
      </li>
    </ul>
  </div>
</div>

  <div class="widget-body innerAll" style="margin:0; background-color: #FFF;">

    <div class="tab-content">
      <!-- Tab content --> 
      <div class="tab-pane active" id="mktplace">

    <form action="/activity" onsubmit="return formSubmit(this);"  role="search" data-step="1" data-intro="Search for anyhing, anywhere" class="form-horizontal">

      <div class="form-group clearfix">
        <label for="companyType" class="col-sm-3 control-label">Find by keyword</label>
        <div class="col-sm-9">
            <div class="btn-group " data-toggle="buttons-radio">
                <button class="btn btn-default  btn-sm" >#buy</button>
                <button class="btn btn-default  btn-sm ">#sell</button>
                <button class="btn btn-default  btn-sm ">#surplus</button>
                <button class="btn btn-default  btn-sm ">#job</button>
            </div> 
        </div>
      </div>
  
      <div class="form-group clearfix" style="background: rgba(200,200,200,0.1);">
        <label for="companyType" class="col-sm-3 control-label">User type</label>
        <div class="col-sm-9">
            <div class="btn-group " data-toggle="buttons-radio">
                <button class="btn btn-default btn-sm active" data-toggle="collapse" data-target="#companygroup" >Companies</button>
                <button class="btn btn-default btn-sm ">Individuals</button>
            </div>
        </div>
      </div>

      <div class="text-center innerAll">
        <a data-toggle="collapse" data-target="#filters2" class="btn btn-default btn-sm"><i class="fa fa-sliders"></i> Advanced filters</a>
      </div>

      <div id="filters2" class="innerAll collapse"> 
        <div class="form-group" id="locationgroup">
          <label for="loc" class="col-sm-3 control-label">Location</label>
          <div class="col-sm-9">
            <div class="input-group  input-group-sm">
              <span class="input-group-addon"><i class="fa fa-map-marker"></i></span>
              <input type="text" name="location" id="pac-input" value="{% if search %}{{ search.place }}{% endif %}{% if not search %}{{userinfo.zip_code}}{% endif %}" class="pac-input form-control  " placeholder="Where?">
              <div class="input-group-btn">
                <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
              </div>
            </div>
            <input type="hidden" name="lon" id="lon" value="{{search.lon}}"/>
            <input type="hidden" name="lat" id="lat" value="{{search.lat}}"/> 
          </div>
        </div>
        
        <div class="form-group" id="organisationgroup">
          <label for="filterOrg" class="col-sm-3 control-label">Organisation</label>
          <div class="col-sm-9">
            <select class="selectpicker show-tick" data-live-search="true" multiple data-selected-text-format="count>2" title="Filter by organisation" name="filterOrg"   data-style="btn-default">
              <option>Soil Association</option><option>
              Pasture Fed LIvestock </option><option>
              Fetc</option> 
          </select>
          </div>
        </div>

        <div class="form-group" id="companygroup">
          <label for="companyType" class="col-sm-3 control-label">Company type</label>
          <div class="col-sm-9">
          <select class="selectpicker show-tick"   data-live-search="true" multiple data-selected-text-format="count>2" title="Filter by company type" name="companyType"  data-style="btn-default">
            <optgroup label="Production">
              <option >Grower</option><option>
              Cafe / coffee shop</option><option>
              Food manufacturer</option><option>
              Food Stall</option><option>
              Restaurant / Pub / Bar</option><option>
              Ready meals</option><option>
              Farm Shop</option><option>
              Health food</option>
            </optgroup>
            <optgroup label="Last mile">
             <option> Drinks manufacturer</option><option>
              Butcher</option><option>
              Marketing</option><option>
              Baker</option><option>
              Arable Farm</option><option>
              Chef / Catering</option><option>
              Individual</option>
            </optgroup> 
          </select>
          </div>
        </div>
      </div><!-- filters -->

    </form> 
<div id="mkt_results"></div>
        </div> 
        <div class="tab-pane" id="profiles"> 

          <form action="/activity" onsubmit="return formSubmit(this);"  role="search" data-step="1" data-intro="Search for anyhing, anywhere" class="form-horizontal">

            <div class="form-group clearfix">
              <label for="companyType" class="col-sm-3 control-label">I want to</label>
              <div class="col-sm-9">
                  <div class="btn-group " data-toggle="buttons-radio">
                      <button class="btn btn-default btn-pwant btn-sm active" >Buy</button>
                      <button class="btn btn-default btn-pwant btn-sm ">Sell</button>
                  </div> 
              </div>
            </div> 

            <div class="form-group clearfix" style="background: rgba(200,200,200,0.1);">
              <label for="companyType" class="col-sm-3 control-label">User type</label>
              <div class="col-sm-9">
                  <div class="btn-group " data-toggle="buttons-radio">
                      <button class="btn btn-default btn-sm active" data-toggle="collapse" data-target="#companygroup" >Companies</button>
                      <button class="btn btn-default btn-sm ">Individuals</button>
                  </div>
              </div>
            </div>

            <div class="text-center innerAll">
              <a data-toggle="collapse" data-target="#filters1" class="btn btn-default btn-sm filters1"><i class="fa fa-sliders"></i> Advanced filters</a>
            </div>

            <div id="filters1" class="innerAll collapse"> 
              <div class="form-group" id="locationgroup">
                <label for="loc" class="col-sm-3 control-label">Location</label>
                <div class="col-sm-9">
                  <div class="input-group  input-group-sm">
                   <span class="input-group-addon"><i class="fa fa-map-marker"></i></span>
                    <input type="text" name="location" id="pac-input" value="{% if search %}{{ search.place }}{% endif %}{% if not search %}{{userinfo.zip_code}}{% endif %}" class="pac-input form-control  " placeholder="Where?">
                    <div class="input-group-btn">
                      <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                    </div>
                  </div>
                  <input type="hidden" name="lon" id="lon" value="{{search.lon}}"/>
                  <input type="hidden" name="lat" id="lat" value="{{search.lat}}"/>  
                </div>
              </div>
              
              <div class="form-group" id="organisationgroup">
                <label for="filterOrg" class="col-sm-3 control-label">Organisation</label>
                <div class="col-sm-9">
                  <select class="selectpicker show-tick" data-live-search="true" multiple data-selected-text-format="count>2" title="Filter by organisation" name="filterOrg"   data-style="btn-default">
                  <optgroup label="Production">
                    <option>Grower</option><option>
                    Cafe / coffee shop</option><option>
                    Food manufacturer</option><option>
                    Food Stall</option><option>
                    Restaurant / Pub / Bar</option><option>
                    Ready meals</option><option>
                    Farm Shop</option><option>
                    Health food</option>
                  </optgroup>
                  <optgroup label="Last mile">
                   <option> Drinks manufacturer</option><option>
                    Butcher</option><option>
                    Marketing</option><option>
                    Baker</option><option>
                    Arable Farm</option><option>
                    Chef / Catering</option><option>
                    Individual</option>
                  </optgroup> 
                </select>
                </div>
              </div>

              <div class="form-group" id="companygroup">
                <label for="companyType" class="col-sm-3 control-label">Company type</label>
                <div class="col-sm-9">
                <select class="selectpicker show-tick"   data-live-search="true" multiple data-selected-text-format="count>2" title="Filter by company type" name="companyType"  data-style="btn-default">
                  <optgroup label="Production">
                    <option >Grower</option><option>
                    Cafe / coffee shop</option><option>
                    Food manufacturer</option><option>
                    Food Stall</option><option>
                    Restaurant / Pub / Bar</option><option>
                    Ready meals</option><option>
                    Farm Shop</option><option>
                    Health food</option>
                  </optgroup>
                  <optgroup label="Last mile">
                   <option> Drinks manufacturer</option><option>
                    Butcher</option><option>
                    Marketing</option><option>
                    Baker</option><option>
                    Arable Farm</option><option>
                    Chef / Catering</option><option>
                    Individual</option>
                  </optgroup> 
                </select>
                </div>
              </div>
            </div><!-- filters -->

          </form> 

          <div id="profile_results"></div>
        </div>
        <!-- // Tab content END -->


    </div>

 </div> <!-- widget -->
 


     
    </div><!-- closes main col -->
    </div>


      <div class="col-sm-8 col-xs-12 fill">
         
          <div id="map"></div>
        
      </div>
    </div>

</div>

    <script type="text/javascript">
 

      // food_filters = {{foods_filter |safe}};
      // business_filters = {{business_filter |safe}};
      // organisation_filters = {{organisation_filter |safe}}; 

      function swith_update_form()
        {
          switch_text_area();
          $("#structured_postupdate").hide();
          $("#update-big").show();
        }






    </script>
      

  {% endblock %}


  {% block footer %}
    {% include "includes/not_logged_in_modal.html" %}
     <script src="{% static "js/activity.js" %}"></script>
     

 {% endblock %}
 {% block javascript %}
 <script type="text/javascript">
      // show_food_filters(food_filters, 0);
      // show_organisation_filters(organisation_filters, 0);
      // show_business_filters(business_filters, 0);
</script>


<!-- resizes the map -->
<script type="text/javascript">
var mapmargin = 0;
$('#map').css("height", ($(window).height() - mapmargin));
$(window).on("resize", resize);
resize();
function resize(){

    if($(window).width()>=980){
        $('#map').css("height", ($(window).height() - mapmargin));    
        $('#map').css("margin-top",0);
    }else{
        $('#map').css("height", ($(window).height() - (mapmargin)));    
        $('#map').css("margin-top",0);
    }

}

</script>
   


 <script src="{% static "js/activity-map.js" %}"></script>
 <script src="{% static "js/functions.js" %}"></script>
 <script src="{% static "js/search.js" %}"></script>

              <script type="text/javascript">


              function update_latest_updates(data)
                {
                    feeds = jQuery.parseJSON(data);
                    var updates  = "";
                    for(var i = 0;i<feeds.length;i++)
                    {
                      var item = feeds[i];
                      updates +='<div class="update" data-toggle="popover" data-title="help" data-tweet-id="'+item.updates.tweet_id+'" data-trigger="manual" data-container="body" data-placement="left" data-original-title="" title="" data-html="true"  >';
                      updates += '<img src="'+item.profile_img+'" class="pull-left" style="width:25px; margin-right: 10px;" /><p class="margin-image-left-small">'+item.updates.status+'<br /><small class="text-muted">'+get_time_text(item.updates.time_stamp)+'</small> </p></div>';


                    }
                    $("#updates").html(updates);
                }


              $(document).ready(function(){
                ajax_request("get_latest_updates", 'update_latest_updates',{});
                
                 $("#updates").on("click",".update",function(e){ 
                  if($(this).attr('data-trigger')!="manual")
                    return;
                  var tweet_id = $(this).attr('data-tweet-id');
                  var that = this;

                  $.post( "/ajax-handler/get_single_tweet", { tweet_id:tweet_id }, function( data ) {
                    var content = "<div class='text-center'><p class=''>This is over 50 miles away. If you'd like to see it, please go ahead and ...</p><a href='/subscribe' class='btn btn-primary'>Upgrade</a></div>";
                      var title = "Aww shucks!!";
                    if(data.status == "ok")
                    {
                      var result = data.result;
                      var content = "<div class=''><div class='timeline-top-info   '>";
                      content += "<div class='  pull-right' style='margin-left: 5px;'>";
                      content += "<a type='button' class='btn btn-primary btn-xs' href='/"+result.username+"/post/"+result.updates.tweet_id+"'>";
                      content += "<i class='fa fa-arrow-right fa-lg' style='color:#fff;'></i> ";
                      content += "</a>";
                      content += "</div>   ";
                      content += "</div>";
                      content += "<div class='media margin-none'>   ";
                      content += "<div class=' '>";
                      content += result.updates.status;
                      content += "</div>";
                      content += "<div class=''>";
                      content += "<img src='"+result.profile_img+"' class='img-responsive'>";
                      content += "</div>";
                      content += "</div> ";
                      content += "<div class='timeline-bottom  border-top clearfix innerTB half'>";
                      content += "<a href='http://maps.google.com/maps?saddr=51.4529956141,-2.62451568043&amp;daddr=51.4619294,-2.5891196' target='_blank' data-placement='top' data-toggle='tooltip' class='pull-right' rel='tooltip' title='' data-original-title='Get directions'> ";
                      content += "<i class='fa fa-location-arrow fa-fw'></i> 1.6 miles  ";
                      content += "</a>";
                      content += "<i class='fa fa-home fa-fw'></i>";
                      content += "<a href='/activity/?b=Grower' class='innerR half'>Grower</a>";
                      content += "</div> ";
                      content += "<div class='border-top innerT'> ";
                      content += "<p class='small text-center'>";
                      content += "<i class='fa fa-comments fa-fw'></i>";
                      content += "<a href='#'>See all 3 replies</a>";
                      content += "</p>";
                      content += "<input class='form-control input-sm enterhandler reply_input' data-tweet-id='476371282137985024' data-main='main' type='text' placeholder='Reply to @severnproject' data-mentions='@severnproject'> ";
                      content += "</div>";
                      content += "</div>";
                      var title = result.name;
                    }
                   
                   $(that).popover({
                              trigger : "click",
                              placement : 'left',
                              html : true,
                              title:title,
                              content: content
                          }).popover("show");
                       $(that).attr('data-trigger',"click");
 
}, "json");
                      
                });
                 });



              </script>
              
{% endblock %}