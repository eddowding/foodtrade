{% load staticfiles %}
{% load staticfiles %}  
{% load socialaccount %}
{% load url from future %}
{% load i18n %}
{% include "socialaccount/snippets/login_extra.html" %}
{% load account %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="http://foodtrade.com/wp-content/uploads/2013/09/favi22.png">
    <title>FoodTrade</title>
    <!-- CSS -->
    <link href="{% static "css/bootstrap.css" %}" rel="stylesheet">
    <link href="{% static "css/foodtrade.css" %}" rel="stylesheet">
    <link href="{% static "css/custom-design.css" %}" rel="stylesheet">
    <link href="{% static "css/chardinjs.css" %}" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
 {% block head %}
{% endblock %}
 <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.css" />
<script src="{% static "js/leaflet.js" %}"></script>
    <!-- Custom styles for this template -->
    <link href="http://getbootstrap.com/examples/navbar-fixed-top/navbar-fixed-top.css" rel="stylesheet">
    <style type="text/css">
.tt-hint
{
  margin-left: 12px;
margin-top: 4px;
background: #eee;
}

.margin-notices{
  margin-left:8%;
  margin-top:11%;
}
    </style>
 
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="ftstrip"></div>
      <div class="container-responsive">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

        <div class="pull-left visible-xs">
          <button type="button" class="navbar-toggle" data-toggle="offcanvas" style="margin-left: 5px">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-user fa-fw fa-lg" ></i>
              </button>
        </div>

          <a href="/" class="navbar-brand">
          <img src="{% static "images/logo.png" %}"  class="hidden-xs" alt="FoodTrade logo"   />
          <img src="{% static "images/logo_icon.png" %}"  class="visible-xs" alt="FoodTrade logo"  />
          </a>
        </div>
        <div class="navbar-collapse collapse">
          
          <form action="/activity" class="navbar-form navbar-left nav-justified" role="search">
          <div data-intro="Search for anything, anywhere" data-position="bottom">
            <div class="form-group" style="margin-right:5px;"> 
              <input type="text" name="q" id="keyword" class="form-control pac-input" value="{{ search.query }}" placeholder="What?"> 
            </div> 
            <div class="form-group" style="margin-right:5px;">
              <input type="text" name="location" id="pac-input" value="{{ search.place }}" class="pac-input form-control hidden-xs hidden-sm" placeholder="Where?">
            </div>
            <input type="hidden" name="lon" id="lon" value="{{search.lon}}"/>
            <input type="hidden" name="lat" id="lat" value="{{search.lat}}"/>
            <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
          </div>
          </form>


        {% if user.is_authenticated %}

          <ul class="nav navbar-nav navbar-right">


               <!--  <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><span
                    class="glyphicon glyphicon-envelope"></span>Inbox <span class="label label-info">32</span>
                </a>
                    <ul class="dropdown-menu">
                        <li><a href="#"><span class="label label-warning">4:00 AM</span>Favourites Snippet</a></li>
                        <li><a href="#"><span class="label label-warning">4:30 AM</span>Email marketing</a></li>
                        <li><a href="#"><span class="label label-warning">5:00 AM</span>Subscriber focused email
                            design</a></li>
                        <li class="divider"></li>
                        <li><a href="#" class="text-center">View All</a></li>
                    </ul>
                </li> -->
              <li id="divNotification" onclick="clear_notification()" class="dropdown">
                <button  class="btn btn-default dropdown-toggle margin-notices" data-toggle="dropdown" type="button">
                  Notice <span id= "notification" class="">{{notification.notification_count}}</span>
                </button>
                <!-- <a id= "notification" href="#" class="dropdown-toggle" data-toggle="dropdown">
                {{notification.notification_count}} <b class="caret"></b></a> -->
                <ul id="liNotification" class="dropdown-menu">
                  <li>Sorry,there is no notification.</li>
                </ul>
              </li><!-- /btn-group -->

                <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <i class="fa fa-user fa-fw"></i> {{userinfo.full_name}} <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/editprofile/{{userinfo.username}}"><i class="fa fa-user fa-fw"></i> Edit profile</a></li>
                        <li><a href="/invite/"><i class="fa fa-twitter fa-fw"></i> Invite friends</a></li>
                        <li><a href="#" id="help"><i class="fa fa-question-circle fa-fw"></i> Show help</a></li>
                        <li class="divider"></li>
                        <li>
                          <a src = "/accounts/logout" onclick="logout()" >
                        <i class="fa fa-power-off fa-fw"></i> Logout</a></li>
                    </ul>
                </li>
            </ul> 
             

          <script type="text/javascript">
          function logout()
          {
            window.location = '/accounts/logout';
          }
          </script>
          

         <button type="button" class="btn btn-default navbar-btn navbar-right visible-sm" style="margin-left: 20px;"  data-toggle="modal" data-target="#newtwitterpost">
            <i class="fa fa-edit fa-fw"></i>  
          </button>

          <button data-intro="Post an update from any screen." data-position="left"  type="button" class="btn btn-default navbar-btn navbar-right hidden-sm" style="margin-left: 20px;"  data-toggle="modal" data-target="#newtwitterpost">
            <i class="fa fa-edit fa-fw"></i> Post update
          </button>

        {% endif %}
        
         <ul class="nav navbar-nav navbar-center visible-md visible-lg">
          <li><a href="/activity">Nearby</a></li>
          <li><a href="/pricing">Pricing</a></li> 
         </ul>
 
         {% if not user.is_authenticated %} 
         <a type="button" class="btn btn-success navbar-btn navbar-right" href="{% provider_login_url "twitter" process="login" %}" style="margin-right: 15px;">
            <i class="fa fa-user fa-fw"></i> <strong>Login</strong> or <strong>Sign up</strong>
          </a>
         {% endif %}
         
        </div><!--/.nav-collapse -->
      </div>
    <div class="ftstrip ftstrip-mini"></div>
    </div>
       <!-- New post Modal -->
          <div class="modal fade" id="newtwitterpost" tabindex="-1" role="dialog" aria-labelledby="newtwitterpost" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content"> 
                <div class="modal-body">               
                  <form accept-charset="UTF-8" action="" method="POST">
                      <textarea id="tweetMessage" class="form-control counted" name="message" placeholder="Type in your message" rows="5" >@myfoodtrade</textarea>
                  </form> 
                </div>
                <div class="modal-footer">
                  <h6 class="pull-left" id="counter">142 characters remaining</h6> 
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary" onclick="UpdateStatus('tweetMessage')">Post update</button>
                </div>
              </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
          </div><!-- /.modal -->
<!-- modal_invite -->
<div class="modal fade" id="modal_login" tabindex="-2" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
   
      <div class="modal-body">
<div class="container-responsive">
  <div class="row">
    <div class="main">
 
      <div class="row">  
        <div class="col-md-12 text-center">
          <a href="{% provider_login_url "twitter" process="login" %}" class="btn btn-lg btn-info btn-block"><i class="fa fa-twitter"></i> Sign in with Twitter</a>
        </div> 
<!-- USE THIS LATER!! 
        <div class="col-xs-6 col-sm-6 col-md-6">
          <a href="#" class="btn btn-lg btn-primary btn-block">Facebook</a>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-6">
          <a href="#" class="btn btn-lg btn-info btn-block">Google</a>
        </div> -->
      </div>
      <div class="login-or">
        <hr class="hr-or">
        <span class="span-or">or</span>
      </div>
      <form role="form">
        <div class="form-group">
          <label for="inputUsernameEmail">Username or email</label>
          <input type="text" class="form-control" id="inputUsernameEmail">
        </div>
        <div class="form-group">
          <a class="pull-right" href="#">Forgot password?</a>
          <label for="inputPassword">Password</label>
          <input type="password" class="form-control" id="inputPassword">
        </div>
        <div class="checkbox pull-right">
          <label>
            <input type="checkbox">
            Remember me </label>
        </div>
        <button type="submit" class="btn btn btn-primary">
          Log In
        </button>
      </form>
    
    </div>
    
  </div>
</div>
 
      </div>
 
      </div> 
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="container-responsive" id="main_page">
 
<div class="row row-offcanvas row-offcanvas-left" id="main_row">
 
<div id="sidebar" class="col-xs-6 col-sm-2 sidebar sidebar-offcanvas" role="navigation">

{% if not user.is_authenticated %} 
<div class="alert alert-info  ">
<a type="button" href="{% provider_login_url "twitter" process="login" %}"  class="btn text-center btn-primary btn-lg btn-block" style="  margin-top: 1em;"><i class="fa fa-twitter fa-fw"></i> Sign in</a>
</a>
</div>
{% endif %}


{% if user.is_authenticated or search.query %}
 {% if user.is_authenticated %}
        <!-- show the logged in users account --> 
        <div id="account_info">
        
        <div class="clearfix" style="margin-bottom: 10px;">
          <!-- twitter 78px image - 'large' -->
          <!--https://dev.twitter.com/docs/user-profile-images-and-banners -->
          <img class="pull-left img-rounded" style="margin:0 8px 0 0; width:30px"  src="{{userinfo.profileimg}}"  />
          <div class="content">
            <h4 style="margin:0;"><a href="/profile/{{userinfo.username}}">{{userinfo.full_name}}</a></h4>
            <small><a href="/editprofile/{{userinfo.username}}" class="text-muted">Edit your profile</a></small>
          </div>
        </div>
         {% if search.query == "" or not search.query %}
           {% ifequal userinfo.user_type 'Business' %}
              <p><a href="#">Trade connections <span class="badge pull-right">{{userinfo.trade_connections_no}}</span></a></p>
              <p><a href="#">Foods <span class="badge pull-right">{{userinfo.food_no}}</span></a></p>
              <p><a href="#">Organisations <span class="badge pull-right">{{userinfo.organisation_connection_no}}</span></a></p>
            {% endifequal %}

        <!-- 
        ADD IN AWARDS FUNCTIONALITY
        <p><a href="#">Awards <span class="badge pull-right">{{userinfo.organisation_connection_no}}</span></a></p>
         -->
          
          <!-- PUT EMPTY ONES AT THE BOTTOM OF THE LIST -->
          <!-- if ZERO ON ANY OF THESE -->
        
       <!--  <div class="alert alert-info small"> 
          <a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>
          <p><b>Want a great profile?</b></p>  
        </div> -->
        {% endif %}
        </div><!-- /account_info -->
<!-- {% if search.query == "" or not search.query %}
    <hr /> 
   
      <h4>Who's nearby</h4>
 
        <p><a href="#">Individuals <span class="badge pull-right">{{userinfo.nearby_individuals_no}}</span></a></p>
        <p><a href="#">Businesses <span class="badge pull-right">{{userinfo.nearby_businesses_no}}</span></a></p> 
         {% endif %} -->
 {% endif %}
 
    {% if search %}
    <div class="foodtrade-sidebar">
    
    <hr>
     
    <div data-intro="Just start typing to search for specific foods, business type, or filter by organisation membership" data-position="right">
    <form role="form" >
      <div class="form-group"> 
        <input type="text" class="form-control" id="food_filter" placeholder="Filter by food">
      </div>
    </form>
    
    <ul class="foodtrade-tag-list">
    <li data-id="ALL" class="foodtrade-tag foodtrade-tag-click foodtrade-tag-all"><div class="foodtrade-tag-checkbox-column"><input type="checkbox" id="all_foods" checked="checked" onclick="make_search()" aria-label="All Partners" class="foodtrade-tag-checkbox"></div><div class="foodtrade-tag-text">All Foods</div><div class="foodtrade-tag-count">{{food_count}}</div></li>
    </ul>

    <ul class="foodtrade-tag-list" id="food_filter_results">
   
    </ul>
     <hr>
 
    
    <form role="form">
      <div class="form-group"> 
        <input type="email" class="form-control" id="business_filter" placeholder="Filter Business Type">
      </div>
    </form>
    <ul class="foodtrade-tag-list">
    <li data-id="ALL" class="foodtrade-tag foodtrade-tag-click foodtrade-tag-all"><div class="foodtrade-tag-checkbox-column"><input type="checkbox" id="all_businesses" checked="checked" onclick="make_search()" aria-label="All Partners" class="foodtrade-tag-checkbox"></div><div class="foodtrade-tag-text">All Businesses</div><div class="foodtrade-tag-count">{{business_count}}</div></li>
</ul>

<ul class="foodtrade-tag-list" id="business_filter_results">
    </ul>
    </div><!-- charding overlay -->
    <hr />
     



     <form role="form">
      <div class="form-group"> 
        <input type="email" class="form-control" id="organisation_filter" placeholder="Filter organisation">
      </div>
    </form>
    <ul class="foodtrade-tag-list">
    <li data-id="ALL" class="foodtrade-tag foodtrade-tag-click foodtrade-tag-all"><div class="foodtrade-tag-checkbox-column"><input type="checkbox" id="all_organisations" checked="checked" onclick="make_search()" aria-label="All Partners" class="foodtrade-tag-checkbox"></div><div class="foodtrade-tag-text">All Organisations</div><div class="foodtrade-tag-count">{{organisation_count}}</div></li>
    </ul>


    <ul class="foodtrade-tag-list" id="organisation_filter_results">
    </ul>
    </div><!--sidebar-->
    {% endif %}

       {% endif %}
    </div>
 {% block content %}
 {% endblock %}  
</div>
</div>

<!-- FOOTER --> 
<div class="container-responsive" id="footer">    
  <div class="row">
    <div class="col-lg-12">
        <div class="ftstrip"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12" id="footer_container">
      <div class="col-md-3">
        <ul class="list-unstyled"><!-- 
          <li>FoodTrade<li> -->
          <li><a href="/about">About us</a></li>
          <li><a href="http://digest.foodtrade.com/" target="_blank">Blog</a></li>
          <li><a href="/contact">Contact & support</a></li>
         </ul>
      </div>
      <div class="col-md-3">
      <!-- 
      developers
      timeline
        <ul class="list-unstyled">
          <li>Applications<li>
          <li><a href="#">Product for Mac</a></li>
          <li><a href="#">Product for Windows</a></li>
          <li><a href="#">Product for Eclipse</a></li>
          <li><a href="#">Product mobile apps</a></li>              
        </ul> -->
      </div>
      <div class="col-md-3">
       <!--  <ul class="list-unstyled">
          <li>Services<li>
          <li><a href="#">Web analytics</a></li>
          <li><a href="#">Presentations</a></li>
          <li><a href="#">Code snippets</a></li>
          <li><a href="#">Job board</a></li>              
        </ul> -->
      </div>
      <div class="col-md-3">
        <ul class="list-unstyled"><!-- 
          <li>Stay connected<li> -->
          <li>
            <a href="http://www.facebook.com/foodtradeHQ"><i class="fa fa-facebook-square fa-2x"></i></a> 
            <a href="http://www.twitter.com/foodtradeHQ"><i class="fa fa-twitter-square fa-2x"></i></a></li>
           </li>
           <!-- Begin MailChimp Signup Form -->
<div id="mc_embed_signup">
<form action="http://sustaination.us2.list-manage1.com/subscribe/post?u=79e1467c02512dbd83bddab5f&amp;id=eeea3ac4c6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div class="input-group"> 
      <input type="email" value="" name="EMAIL"  class="form-control required" name="q"  id="mce-EMAIL"  placeholder="Email Address">
      <span class="input-group-btn">
          <button type="submit" class="btn btn-success"> Subscribe</button>
      </span>
    </div>
      <div id="mce-responses" class="clear">
    <div class="response" id="mce-error-response" style="display:none"></div>
    <div class="response" id="mce-success-response" style="display:none"></div>
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_79e1467c02512dbd83bddab5f_eeea3ac4c6" value=""></div>
  </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
</form>
 
  
      
<!--End mc_embed_signup-->     
        </ul>
      </div>  
    </div>
  </div>
  <hr>
  <div class="row">
    <div class="col-lg-12">
      <div class="col-md-8">
        <a href="/pages/terms">Terms of Service</a>    | 
        <a href="/pages/privacy">Privacy</a>  
      </div>
      <div class="col-md-4">
        <p class="muted pull-right">&copy; 2013 Foodtrade. All rights reserved</p>
      </div>
    </div>
  </div>
</div>

<!-- Button trigger modal -->
<button id="btn_must_be_logged" style="display:none" data-toggle="modal" data-target="#myModal_must_be_logged">
</button>

<!-- Modal -->
<div class="modal fade" id="myModal_must_be_logged" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <h4 class="modal-title" id="myModalLabel">You must be <a href="/accounts/twitter/login/?process=login">logged</a> in to use this feature</h4>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- UserVoice JavaScript SDK (only needed once on a page) -->
<script>(function(){var uv=document.createElement('script');uv.type='text/javascript';uv.async=true;uv.src='//widget.uservoice.com/HloB2aRxdk7fbhWMOI5AlQ.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(uv,s)})()</script>
<!-- A tab to launch the Classic Widget -->
<script>UserVoice=window.UserVoice||[];UserVoice.push(['showTab','classic_widget',{mode:'full',primary_color:'#f08119',link_color:'#61ae32',default_mode:'support',forum_id:231923,tab_label:'Feedback & Support',tab_color:'#cc6d00',tab_position:'middle-right',tab_inverted:false}]);</script>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{% static "js/jquery.js" %}"></script>
    <script src="{% static "js/bootstrap.min.js" %}"></script>
    <script src="{% static "js/foodtrade.js" %}"></script>
     <script src="{% static "js/ajax-handle.js" %}"></script>
     <script src="{% static "js/chardinjs.min.js" %}"></script>
     
 <script src="http://getbootstrap.com/2.3.2/assets/js/bootstrap-typeahead.js"></script>
         {% block footer %}
 {% endblock %}
     <script type="text/javascript">
$(document).ready(function() {

    $( "#help" ).click(function() {
      $('body').chardinJs('start');
    });

    var activeSystemClass = $('.list-group-item.active');
    //something is entered in search form
    $('#system-search').keyup( function() {
       var that = this;
        // affect all table rows on in systems table
        var tableBody = $('.table-list-search tbody');
        var tableRowsClass = $('.table-list-search tbody tr');
        $('.search-sf').remove();
        tableRowsClass.each( function(i, val) {
        
            //Lower text for case insensitive
            var rowText = $(val).text().toLowerCase();
            var inputText = $(that).val().toLowerCase();
            if(inputText != '')
            {
                $('.search-query-sf').remove();
                tableBody.prepend('<tr class="search-query-sf"><td colspan="6"><strong>Searching for: "'
                    + $(that).val()
                    + '"</strong></td></tr>');
            }
            else
            {
                $('.search-query-sf').remove();
            }
            if( rowText.indexOf( inputText ) == -1 )
            {
                //hide rows
                tableRowsClass.eq(i).hide();
                
            }
            else
            {
                $('.search-sf').remove();
                tableRowsClass.eq(i).show();
            }
        });
        //all tr elements are hidden
        if(tableRowsClass.children(':visible').length == 0)
        {
            tableBody.append('<tr class="search-sf"><td class="text-muted" colspan="6">No entries found.</td></tr>');
        }
    });
});
    </script>
    <script type="text/javascript">
      $('.tip').tooltip()

      $('[data-toggle=offcanvas]').click(function() {
        $('.row-offcanvas').toggleClass('active');
      });

       $('#media').carousel({
          interval: 7000,
        });



      /**
 *
 * jquery.charcounter.js version 1.2
 * requires jQuery version 1.2 or higher
 * Copyright (c) 2007 Tom Deater (http://www.tomdeater.com)
 * Licensed under the MIT License:
 * http://www.opensource.org/licenses/mit-license.php
 * 
 */
 
(function($) {
    /**
   * attaches a character counter to each textarea element in the jQuery object
   * usage: $("#myTextArea").charCounter(max, settings);
   */
  
  $.fn.charCounter = function (max, settings) {
    max = max || 100;
    settings = $.extend({
      container: "<span></span>",
      classname: "charcounter",
      format: "(%1 characters remaining)",
      pulse: true,
      delay: 0
    }, settings);
    var p, timeout;
    
    function count(el, container) {
      el = $(el);
      if (el.val().length > max) {
          el.val(el.val().substring(0, max));
          if (settings.pulse && !p) {
            pulse(container, true);
          };
      };
      if (settings.delay > 0) {
        if (timeout) {
          window.clearTimeout(timeout);
        }
        timeout = window.setTimeout(function () {
          container.html(settings.format.replace(/%1/, (max - el.val().length)));
        }, settings.delay);
      } else {
        container.html(settings.format.replace(/%1/, (max - el.val().length)));
      }
    };
    
    function pulse(el, again) {
      if (p) {
        window.clearTimeout(p);
        p = null;
      };
      el.animate({ opacity: 0.1 }, 100, function () {
        $(this).animate({ opacity: 1.0 }, 100);
      });
      if (again) {
        p = window.setTimeout(function () { pulse(el) }, 200);
      };
    };
    
    return this.each(function () {
      var container;
      if (!settings.container.match(/^<.+>$/)) {
        // use existing element to hold counter message
        container = $(settings.container);
      } else {
        // append element to hold counter message (clean up old element first)
        $(this).next("." + settings.classname).remove();
        container = $(settings.container)
                .insertAfter(this)
                .addClass(settings.classname);
      }
      $(this)
        .unbind(".charCounter")
        .bind("keydown.charCounter", function () { count(this, container); })
        .bind("keypress.charCounter", function () { count(this, container); })
        .bind("keyup.charCounter", function () { count(this, container); })
        .bind("focus.charCounter", function () { count(this, container); })
        .bind("mouseover.charCounter", function () { count(this, container); })
        .bind("mouseout.charCounter", function () { count(this, container); })
        .bind("paste.charCounter", function () { 
          var me = this;
          setTimeout(function () { count(me, container); }, 10);
        });
      if (this.addEventListener) {
        this.addEventListener('input', function () { count(this, container); }, false);
      };
      count(this, container);
    });
  };
})(jQuery);
$(function() {
    $(".counted").charCounter(320,{container: "#counter"});
});
    </script>
<script type="text/javascript">
// This example adds a search box to a map, using the Google Place Autocomplete
// feature. People can enter geographical searches. The search box will return a
// pick list containing a mix of places and predicted search terms.

{% if user.is_authenticated %}
  window.setInterval(function(){
    show_notifications();
  }, 30000);
{% endif %}
function  show_notifications(){
  ajax_request('getnotification', 'build_notification', {'user':'{{userinfo.username}}'})
}
var change_data;
function build_notification(data){
  data = jQuery.parseJSON(data);
  change_data = data;
  $('#liNotification').html('');
  $('#notification').html(String(data['notification_count']));
  for (eachNotification in data['notifications']){
      var data_dict = data['notifications'][eachNotification];
      $('#liNotification').prepend('<li><a href="/profile/' + String(data_dict.notifying_user) + '/" title="' + String(data_dict.notification_message) + '">' +String(data_dict.notification_message).substr(0,20)+'....</a></li>');
  }
  if (data['notification_count'] == 0){
      $('#liNotification').prepend('<li>Sorry,there is no notification.</li>');
  }
}
function clear_notification(){
  $('#notification').html(String('0'));
  ajax_request('change_notification_status','','')
}

function validate_login(){
  {% if user.is_authenticated %}
    return {'status':'1'}
  {% endif %}
  {% if not user.is_authenticated %}
    return {'status':'0'}
  {% endif %}
  /*
  ajax_request('validate_logged_in', 'ajax_success_validate_logged_in','');*/
}
</script>    
  </body>
</html>
