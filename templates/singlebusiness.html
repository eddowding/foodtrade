{% extends 'tbase.html' %}
{% load staticfiles %}
{% load socialaccount %}
{% load activity_tags %}
{% load recognise_name %}
{% load url from future %}
{% load i18n %}
{% include "socialaccount/snippets/login_extra.html" %}
{% load account %}


{% block ogtype %}{% if userprof.user_type == "Business" %}business.business{%endif%}{% if userprof.user_type == "Individual" %}Profile{%endif%}{% if userprof.user_type == "Organisation" %}business.business{%endif%}{% endblock %}

{% block titlecontent %}{{userprof.full_name}}{% endblock %}
{% block description %}{{userprof.description}}{% endblock %}

{% block fblat %}{{userprof.lat}}{% endblock %}
{% block fblon %}{{userprof.lon}}{% endblock %}
{% block fbzipcode %}{{userprof.zip_code}}{% endblock %}
{% block fbcountry %}{{userprof.country}}{% endblock %}
{% block ogimg %}{{userprof.profileimg}}{% endblock %}

{% block titlemain %}{{userprof.full_name}}{% endblock %}
{% block metatitle %}{{userprof.full_name}}{% endblock %}

{% block metadescription %}{{userprof.description}}{% endblock %}

{% block contact %}
  {% if userprof.user_type == 'Business' or userprof.user_type == 'Organisation'%}
  <meta property="business:contact_data:postal_code"    content="{{userprof.zip_code}}" /> 
  <meta property="business:contact_data:country_name"   content="{{userprof.country}}" /> 
  <meta property="business:contact_data:street_address" content="{{userprof.address}}" /> 
  <meta property="business:contact_data:locality"       content="{{userprof.address}}" /> 
  {% endif %}
{% endblock %}

{% block content %}

{% include 'modal_invite.html' %}
{% include "modal_user_twitter_check_request.html" %}

  <link rel="stylesheet" href="/static/css/chosen.min.css">

<link href="{% static "css/jquery.tagit.css" %}" rel="stylesheet" type="text/css">
<link href="{% static "css/tagit.ui-zendesk.css" %}" rel="stylesheet" type="text/css">


<style type="text/css" media="all">
    /* fix rtl for demo */
    .chosen-rtl .chosen-drop { left: -9000px; } 
</style>

<!-- NEW -->
<!-- <div class="layout-app">  -->

 


<div class="page">


<div class="row row-merge bizSummary bg-gray" data-spy="affix" id="scrollInfo">
<div class="ftstrip"></div>
<div class="col-xs-9 bg-gray border-right">
   <div class="innerAll">
      <div class="media">
      <img src="{{pic_url}}"  alt="{{name}} logo" class="pull-left avatar">
      <div class="media-body"> 
      {% if request.user.is_authenticated %}
        <div id="shortcuts" class=" pull-right">
          <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modal_contact"><i class="fa fa-envelope-o fa-fw"></i> Contact</button>
        </div>
      {% endif %}

        <h2 class="margin-none">{{name}}</h2>

        {% if type_user|length == 0 or type_user|first == '' %}
        {% else %}
        <span class="tags tags-biztype  ">  
          {% for eachtype in type_user %}
         <a href="/activity/?b={{eachtype}}">{{eachtype}}</a>
         {% endfor %}
        </span> 
        {% endif %} 
      </div> 
      </div>
    </div>
</div>

<div class="col-xs-3 bg-gray border-right ">
  <div class="{% if not user.is_authenticated %} hidden {% endif %}  clearfix" id="distanceAway">
     
  
      <!-- if logged in or you've allows html5 browser location -->
   
      <span class="lead bold"> {{distance}} miles  </span>
      <small class="small clearfix margin0 hidden-xs">away from you</small>

  </div> 
</div>

</div>



<!---    -->
<div class="row row-merge bizSummary">
  <div class="col-xs-12"> 
   
    <div class="map-biz" id="map"></div> 
    <div id="biz-info" class="text-center innerAll"> 
      <div class="media" >
        <img src="{{pic_url}}"  alt="{{name}} logo" class="  avatar">
        <div class="media-body"> 
          {% if request.user.is_authenticated %}
            <div id="shortcuts" class=" pull-right">
              <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modal_contact"><i class="fa fa-envelope-o fa-fw"></i> Contact</button>
            </div>
          {% endif %}

          <h2 class="text-white">{{name}}</h2>

          {% if type_user|length == 0 or type_user|first == '' %}
          {% else %}
          <span class="tags tags-biztype  ">  
            {% for eachtype in type_user %}
           <a href="/activity/?b={{eachtype}}">{{eachtype}}</a>
           {% endfor %}
          </span> 
          {% endif %}  

          <p class="text-white">{{description}}</p>  
  
          {% if user.is_superuser %}
            <a href="/editprofile/{{username}}/" class="btn btn-info btn-xs">Edit</a>
          {% endif %}
        </div>
      </div> 
  
      <div class="{% if not user.is_authenticated %} hidden {% endif %}  clearfix text-white" id="">
        <span class="lead bold margin0"> {{distance}} miles  </span>
        <small class="small clearfix margin0 hidden-xs">away from you</small>
      </div> 

      <!-- EDIT / CONTACT -->
      {% ifequal profile_id user_id %}
        <a href="/editprofile/{{userinfo.username}}" class="btn btn-info btn-block btn-sm ">
           Edit
        </a>       
      {% endifequal %}
      
      {% if request.user.is_authenticated %}
        <div class="innerT">
          <button class="btn btn-primary text-center normal" data-toggle="modal" data-target="#modal_contact"><i class="fa fa-envelope-o fa-fw"></i> Contact</button>
        </div>
      {% endif %} 

      {% ifequal is_unknown_profile 'false' %}
      {% else %}<br />
        {% if screen_name != '@' %}
        <a class="text-white strong pointer"  data-toggle="modal" data-target="#modal_invite">Invite to connect</a> 
        {% endif %}        
      {% endifequal %} 
      <!-- EDIT / CONTACT -->

      <div class="clearfix" id="bizactions">
        <!-- SHARE -->
        <div class="btn-group pull-left" >
          <button type="button"  class="btn btn-default dropdown-toggle normal btn-stroke text-white" data-toggle="dropdown"  ><i class="fa fa-fw fa-share-alt  text-white "></i> share</button>
            <ul class="dropdown-menu text-left">
             <li><a href="/{{username}}"><i class="fa fa-fw fa-lg fa-link"></i> foodtrade.com/{{username}}</a></li>
             <li> <a href="#" class="" target="_blank" onclick="window.open(
              'https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]='+encodeURIComponent('{{ request.build_absolute_uri }}') +'&amp;p[images][0]='+encodeURIComponent('{{pic_url}}')+'&amp;p[title]='+encodeURIComponent('{{name}} on FoodTrade')+'&amp;p[summary]='+encodeURIComponent('Hey, see my profile on FoodTrade')+'&amp;u='+encodeURIComponent('{{ request.build_absolute_uri }}') +'&amp;t='+encodeURIComponent('{{name}} on FoodTrade'),
                    'facebook-share-dialog', 
                    'width=626,height=436,top='+((screen.height - 436) / 2)+',left='+((screen.width - 626)/2 )); 
                  return false;">

                <i class="fa fa-facebook fa-lg fb fa-fw"></i> Share on facebook 
              </a></li>
              <li>
              <a href="#" class="  " target="_blank" onclick="window.open(
                    'https://twitter.com/share?url='+encodeURIComponent('{{ request.build_absolute_uri }}')+'&amp;text='+encodeURIComponent('{{screen_name}} on @foodtradeHQ') + '&amp;count=none/', 
                    'twitter-share-dialog', 
                    'width=626,height=436,top='+((screen.height - 436) / 2)+',left='+((screen.width - 626)/2 )); 
                  return false;">
                <i class="fa fa-twitter fa-lg tw fa-fw"></i> Tweet this
              </a></li><li>

              <a class=" " target="_blank" href="http://pinterest.com/pin/create/button/?url={{ request.build_absolute_uri|urlencode }}&media={{pic_url|urlencode}}&description={{screen_name|urlencode}}{{' on FoodTrade'|urlencode}}" class="pin-it-button" count-layout="horizontal">
                <i class="fa fa-pinterest fa-lg pinterest fa-fw"></i> Pin to pinterest
              </a> </li><li>
              <a  class="" target="_blank" href="https://plus.google.com/share?url={{ request.build_absolute_uri|urlencode }}">
                <i class="fa fa-google-plus fa-lg google fa-fw"></i>  Share on Google+
              </a></li><li>
              <a  class=" " target="_blank" href="http://www.tumblr.com/share" title="Share on Tumblr">
                <i class="fa fa-tumblr fa-lg tumblr fa-fw"></i> Post to Tumblr
              </a>
                 </li><li>
              <a  class=" " target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri|urlencode}}&title={{screen_name}} on FoodTrade&summary=Hey, view my profile on Foodtrade.&source=">
                <i class="fa fa-linkedin fa-lg linkin fa-fw"></i>  Share on LinkedIn
              </a></li> 
              <script type="text/javascript" src="http://platform.tumblr.com/v1/share.js"></script>
            </ul>
          </div>

          {% if request.user.is_authenticated %}
          <div class="btn-group pull-right" data-toggle="buttons">
            <label class="btn btn-default btn-stroke btn-sm {% if fav_profile %} active {% else %}{% endif %}">
              <input type="checkbox" id="favourite_btn" {% if fav_profile %} checked="checked" {% endif %} onchange="save_favourites('{{profile_id}}', '{{user_id}}'); return null;"> <i class="fa fa-star-o fa-fw  text-white"></i> 
              <span class="fav text-white">Favourite</span>
            </label> 
          </div>
          {% endif %}
        </div>
      </div>


    </div>
  </div><!-- col map --> 
</div>



<div class="row row-merge bizSummary hidden">
<div class="col-xs-12">

<div class="row row-merge border-bottom border-right">
  <div class="col-sm-7 col-xs-8 border-left">
    <div class="innerAll">
       

      <p class="">{{description}}</p>  
      {% if user.is_superuser %}
        <a href="/editprofile/{{username}}/" class="btn btn-info btn-xs">Edit</a>
      {% endif %}

    </div> 
  </div>
  <div class="col-sm-3 col-xs-4">
    <div class="innerAll">


    
      <!-- EDIT / CONTACT -->
      {% ifequal profile_id user_id %}
        <a href="/editprofile/{{userinfo.username}}" class="btn btn-info btn-block btn-sm ">
           Edit
        </a>       
      {% endifequal %}
      
      {% if request.user.is_authenticated %}
        <button class="btn btn-primary text-center normal btn-block" data-toggle="modal" data-target="#modal_contact"><i class="fa fa-envelope-o fa-fw"></i> Contact</button>
      {% endif %} 

      {% ifequal is_unknown_profile 'false' %}
      {% else %}
        <button class="btn btn-primary btn-stroke btn-block"  data-toggle="modal" data-target="#modal_invite">Invite to connect</button> 
      {% endifequal %} 
      <!-- EDIT / CONTACT -->


      <!-- CONNECT AS BUSINESS OR CUSTOMER --> 
      {% ifnotequal profile_id user_id %}
        {% if user.is_authenticated %}      

          <!-- if logged in users = individual --> 
          {% ifequal loggedin_signupas "Individual" %}
           <div class="btn-group btn-block" data-toggle="buttons">
            {% if logged_customer %}
                <label class=" btn btn-info btn-block active" style="width:100%; font-size: 12px;" >
                <input type="checkbox" checked="checked" id="customer-chkbx" onchange="add_customer({{profile_id}}, {{user_id}})" rel="tooltip" title="{{userinfo.full_name}} is customer of {{name}}"><i class="fa fa-smile-o fa-fw fa-lg"></i>  I'm a customer!
                </label>      
                {% else %}
                <label class=" btn btn-default btn-block" style="width:100%; font-size: 12px;" rel="tooltip" title="{{userinfo.full_name}} is customer of {{name}}" >
                <input type="checkbox" id="customer-chkbx" onchange="add_customer({{profile_id}}, {{user_id}})"  rel="tooltip" title="{{userinfo.full_name}} is customer of {{name}}"><i class="fa fa-smile-o fa-fw"></i> I'm a customer!
                </label>      
            {% endif %}
           </div>
          {% endifequal %}

          <!-- if logged in users = business --> 
          {% ifequal loggedin_signupas "Business" %} 
            <div class="btn-group btn-block " data-toggle="buttons">
              <button class="btn btn-default btn-sm " style="background: url('{{userinfo.profileimg}}'); background-size: cover;width:10%;">&nbsp;</button>
              {% if logged_conn == "seller"  or logged_conn == "both" %}
                <label class="btn btn-default active btn-sm" rel="tooltip" style="width:40%;" title="{{userinfo.full_name}} buys from {{name}}"> 
                <input type="checkbox" checked id="buy_from" onchange="conn_handler('buy_from', {{profile_id}})">buys from
              {% else %}
                <label class="btn btn-default btn-sm"  rel="tooltip" style="width:40%;"  title="{{userinfo.full_name}} buys from {{name}}"> 
                <input type="checkbox" id="buy_from" onchange="conn_handler('buy_from', {{profile_id}})"> buys from
              {% endif %}
                {% comment %} 
                <input type="checkbox" id="buy_from" onchange="conn_handler('buy_from', {{profile_id}})"> buys from
                {% endcomment %}
              </label>

              <!-- showing active mode if button is selected -->
              {% if logged_conn == "buyer" or logged_conn == "both" %}
                <label class="btn btn-default active btn-sm" rel="tooltip" style="width:40%;"  title="{{userinfo.full_name}} sells to {{name}}" > 
                <input type="checkbox" checked id="sell_to" onchange="conn_handler('sell_to', {{profile_id}})"> sells to
              {% else %}
                <label class="btn btn-default btn-sm"  rel="tooltip" style="width:40%;"   title="{{userinfo.full_name}} sells to {{name}}" > 
                <input type="checkbox" id="sell_to" onchange="conn_handler('sell_to', {{profile_id}})"> sells to
              {% endif %}
                {% comment %}
                <input type="checkbox" id="sell_to" onchange="conn_handler('sell_to', {{profile_id}})"> sells to
                {% endcomment %}
              </label> 
              <button class="btn btn-default btn-sm"  style="background: url('{{pic_url}}'); background-size: cover; width:10%;">&nbsp;</button>
             </div>
          {% endifequal %}

        {% else %}

          <!-- if not logged in show login prompt -->
          <a href="{% provider_login_url "twitter" process="login" %}" class="btn btn-primary btn-block text-center"><i class="fa fa-lg fa-twitter"></i> 

          Sign in <span class="normal">for more detail</span>
          </a>

        {% endif %}

      {% endifnotequal %}
      <!-- / CONNECT AS BUSINESS OR CUSTOMER --> 



      <!-- VERIFIED PROFILE -->
      {% if prof_subscribed %}
      <button class="btn btn-primary btn-block btn-sm btn-stroke">
        <i class="fa fa-check"></i>
        <span>Verified</span>
      </button> 
      {% endif %}  
      <!-- VERIFIED PROFILE -->


  

    </div>  

    </div> 

 
  <div class="col-sm-2 hidden-xs">
    
    
  

    <div class="innerAll "> 

    <!-- SHARE -->
 
        <div class="btn-group btn-block" >
          <button type="button"  class="btn btn-default btn-block dropdown-toggle normal" data-toggle="dropdown"  ><i class="fa fa-fw fa-share-alt text-black "></i> share</button>
            <ul class="dropdown-menu ">
             <li><a href="/{{username}}"><i class="fa fa-fw fa-lg fa-link"></i> foodtrade.com/{{username}}</a></li>
             <li> <a href="#" class="" onclick="window.open(
              'https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]='+encodeURIComponent('{{ request.build_absolute_uri }}') +'&amp;p[images][0]='+encodeURIComponent('{{pic_url}}')+'&amp;p[title]='+encodeURIComponent('{{name}} on FoodTrade')+'&amp;p[summary]='+encodeURIComponent('Hey, see my profile on FoodTrade')+'&amp;u='+encodeURIComponent('{{ request.build_absolute_uri }}') +'&amp;t='+encodeURIComponent('{{name}} on FoodTrade'),
                    'facebook-share-dialog', 
                    'width=626,height=436,top='+((screen.height - 436) / 2)+',left='+((screen.width - 626)/2 )); 
                  return false;">

                <i class="fa fa-facebook fa-lg fb fa-fw"></i> Share on facebook 
              </a></li>
              <li>
              <a href="#" class="  " onclick="window.open(
                    'https://twitter.com/share?url='+encodeURIComponent('{{ request.build_absolute_uri }}')+'&amp;text='+encodeURIComponent('{{screen_name}} on @foodtradeHQ') + '&amp;count=none/', 
                    'twitter-share-dialog', 
                    'width=626,height=436,top='+((screen.height - 436) / 2)+',left='+((screen.width - 626)/2 )); 
                  return false;">
                <i class="fa fa-twitter fa-lg tw fa-fw"></i> Tweet this
              </a></li><li>
  
              <a class=" " href="http://pinterest.com/pin/create/button/?url={{ request.build_absolute_uri|urlencode }}&media={{pic_url|urlencode}}&description={{screen_name|urlencode}}{{' on FoodTrade'|urlencode}}" class="pin-it-button" count-layout="horizontal">
                <i class="fa fa-pinterest fa-lg pinterest fa-fw"></i> Pin to pinterest
              </a> </li><li>
              <a  class="" href="https://plus.google.com/share?url={{ request.build_absolute_uri|urlencode }}">
                <i class="fa fa-google-plus fa-lg google fa-fw"></i>  Share on Google+
              </a></li><li>
              <a  class=" " href="http://www.tumblr.com/share" title="Share on Tumblr">
                <i class="fa fa-tumblr fa-lg tumblr fa-fw"></i> Post to Tumblr
              </a>
                 </li><li>
              <a  class=" " href="http://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri|urlencode}}&title={{screen_name}} on FoodTrade&summary=Hey, view my profile on Foodtrade.&source=">
                <i class="fa fa-linkedin fa-lg linkin fa-fw"></i>  Share on LinkedIn
              </a></li> 
              <script type="text/javascript" src="http://platform.tumblr.com/v1/share.js"></script>
            </ul>
          </div>

          {% if request.user.is_authenticated %}
          <div class="btn-group btn-block" data-toggle="buttons">
            <label class="btn btn-default btn-block  {% if fav_profile %} active {% else %}{% endif %}">
              <input type="checkbox" id="favourite_btn" {% if fav_profile %} checked="checked" {% endif %} onchange="save_favourites('{{profile_id}}', '{{user_id}}'); return null;"> <i class="fa fa-star-o fa-fw text-black"></i> 
              <span class="fav">Favourite</span>
            </label> 
          </div>
          {% endif %}

      </div>
    </div>
  </div><!-- col2 -->
</div>
</div>  
<!-- contact -->  

</div><!-- row --> 

<!-- Nav tabs -->
<ul class="nav nav-tabs text-center" role="tablist">
  <li class="active"><a href="#produce" role="tab" data-toggle="tab">Produce</a></li>
  <li><a href="#tradeswith" role="tab" data-toggle="tab">Stockists &amp; suppliers</a></li> 
  <li><a href="#about" role="tab" data-toggle="tab">About</a></li>
  <li><a href="#trade" role="tab" data-toggle="tab">Trade</a></li> 
</ul>


<div class="row innerLR ">
  <div class="container" id="panelContainer">


<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane fade in active" id="produce">
  
    {% if profile_id == user_id %}
      <div class="panel panel-info">
        <div class="panel-heading">
          <div class="panel-title">
            Tips for your profile
          </div>
        </div>
        <div class="panel-body small">
          <ol class="margin0 lead" style="padding-left: 10px;">
            {% if show_foods != "false"%}  
               <li><a href="#" rel="tooltip" title="You can add photos, description, quantity, seasonality... If you don't want to list anything here, edit your profile and turn off the foods option."><strong>Add produce you sell</strong></a></li>   
            {% endif %}
       

            {% if intro_video = '' %}      
             <li><a href="/editprofile/me" rel="tooltip" title="A 15 second video on instagram (or youtube, vine, etc) literally adds character"><strong>Make a video</strong></a> </li>
            {% endif %}

             <li><a href="#" rel="tooltip" title="Find the 'Buys from' panel and click 'add one' to get going"><strong>Add suppliers</strong></a> - you currently have {{b_conn_no}} suppliers listed.  </li>
             
             <li><a href="#" rel="tooltip" title="Find the 'Sells to' panel and click 'add one' to get going"><strong>Add stockists</strong></a> - you currently have {{c_conn_no}} stockists listed.  </li>
             
             {% if all_buying_foods|length != 0 %}
             <li><a href="#" rel="tooltip" title="If there's things you need, add 'em here and let the good(s) come to you.."><strong>What's on your shopping list?</strong></a> </li>
             {% endif %}

             <li><a href="#" rel="tooltip" title="Be sure to add any organisations or certifiers you work with. People uses them as filters to narrow the selection."><strong>Check your memberships </strong></a></li>

             <li><a href="#" rel="tooltip" title="Make sure this is up to date to help new customers trust you."><strong>Keep your company information updated</strong></a> </li>

             <li><a href="#" rel="tooltip" title="Individual users will see an 'I'm a customer' link on this page. Clicking it starts building up a map of your where they live, allowing you to better plan deliveries and expansion."><strong>Engage your customers</strong></a> - you currently have {{customers|length}}.  </li>
          
          </ol>
        </div>         
      </div> 
      {% endif %}

      <!-- VIDEO -->      
      {% if intro_video %}
        <div class="panel panel-default">
          <div style="width:100%; height: 400px;">{{intro_video|safe}}</div>
        </div> 
      {% endif %}  
      <!-- VIDEO --> 

       {% if show_foods %} 
        <div class="panel panel-default" id="panelProduce">
          <div class="panel-heading">
            <div class="panel-title">

              <i class="fa fa-cutlery"></i> <strong>Produce</strong> sold here

              <div class="pull-right">
                {% if userprof.food_no != 0 %}<span class="badge">{{userprof.food_no}}</span>{% endif %}

                {% if userprof.food_no != 0 %}
                <span data-target="#searchProduce" data-toggle="collapse" class=" innerL">
                  <i class="fa fa-search fa-fw"></i>
                </span>
                {% endif %} 

                {% if user.is_authenticated %}
                  <a data-toggle="collapse" class="label label-primary label-stroke" data-target="#addProduce" rel="tooltip" title="Add new produce">
                   <i class="fa fa-plus-circle"></i> Add
                  </a> 
                {% endif %} 
              </div>
            </div>
          </div> 

          {% if user.is_authenticated %}
          <div id="addProduce" class="{% if userprof.food_no != 0 %}collapse{% endif %} well-sm well clearfix">
          {% if userprof.food_no = 0 %}
            <p class="small text-center">What does {{username}} sell?</p>
          {% endif %}
                <div class="input-group" style="margin: 0 auto;"> 
                  <div class='pull-left'>
                    <select id="myselect" data-placeholder="Add produce available here" style="height:15px; width: 192px; padding: 10px 5px;" multiple class="chosen-select" >

                    <option value=""></option> 
                   {% for each in all_tags %}
                      <optgroup label={{each.node}}>
                      {% if each.childrens %}
                      {% for eachchild in each.childrens %}
                      <option>{{eachchild.node}}</option>
                      {% endfor %}
                    {% else %}
                      <option>{{each.node}}</option>
                    {% endif %}
                      </optgroup>
                    {% endfor %}
                    </select>
                  </div>

                  <div class="pull-left">
                    <span class="input-group-btn">
                      <button class="btn btn-inverse  btn-sm" id="adfoo_id" rel="tooltip" style="height:35px;" onClick="add_food({{profile_id}})" {% if not user.is_authenticated %} title="Please log in to use this feature." {% endif %} > Add</button>
                    </span>
                  </div>
                </div>       
          </div>
          {% endif %}

          
          <div class="collapse well-sm well" id="searchProduce">
            <input type="text" class="form-control" id="filterFoods" placeholder="Find a food" />
          </div> 

          {% if user.is_authenticated %}
          {% else %}
          <div class="panel-body">
            <p class=""><a href="{% provider_login_url "twitter" process="login" %}" class="">Login</a> or <a href="{% provider_login_url "twitter" process="login" %}" class="">sign up free</a> to see a complete list of produce available here. It's free, don't worry, we just want you to be part of it so you can share and contribute easily.</p>
          </div>
          {% endif %}
     
          <div class="mCustomScrollbar scroll300">
            <table class="table table-hover table-condensed footable toggle-circle" id="produceTable" data-filter="#filterFoods" data-filter-text-only="true"> 
            <thead class="hidden">
                <tr> 
                  <th data-hide="" data-toggle="true">
                    more arrow
                  </th> 
                  <th data-hide=""  >
                    Produce
                  </th>
                  <th data-hide=" " >
                    Tags
                  </th>
                  <th data-hide="all" >
                    Description
                  </th>
                  <th data-hide="all">
                     
                  </th>
                  <th data-hide="">
                    Vouch
                  </th>
                  <th data-hide="all">
                    Season
                  </th>
                  <th data-hide="all">
                    Quantity
                  </th>
                  <th data-hide=" ">
                    Vouchers
                  </th>
                  <th data-hide="all">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody id="ajax_food_tr">
                {% include 'ajax_food_tr.html' %}
              </tbody>
            </table>
          </div>
     
        </div>
        {% endif %}


    <!-- PHOTO --> 
    {% ifnotequal banner_url '' %}
      <div class="panel panel-default">
        <img src="{{banner_url}}" class="img-responsive">
      </div>
    {% endifnotequal %} 
    <!-- PHOTO --> 


    <!-- ad --> 

    {% ifequal loggedin_signupas "Individual" %}  
    <div class="panel panel-default">
      <div class="widget text-center margin0">
        <div class="innerAll text-white" style="background: #8BD1ED;">
            <div class="innerB">
              <img src="/static/images/farmdrop.png" style="max-height: 100px;" />
            </div>
            <p class="lead"> Join FarmDrop to get delicious, local &amp; seasonal food whilst supporting independent producers in your community.</p>
            <a href="https://www.farmdrop.co.uk" target="_blank" class="btn btn-default btn-stroke text-white">Find out more <i class="fa fa-fw fa-play-circle  text-white"></i>
            </a> 
        </div>
        <!-- Ribbon -->
        <div class="ribbon-wrapper">
            <div class="ribbon primary">Buy local!</div>
        </div>
      </div>
    </div>
    {% endifequal %}



    {% ifequal loggedin_signupas "Business" %}  
    <div class="panel panel-default">
      <div class="widget text-center bg-secondary margin0">
        <div class="innerAll text-white">
            <div class="innerB"><i class=" icon-rocket fa fa-4x text-faded"></i>
            </div>
            <h2 class="strong margin-none text-white">Better, together</h2>
            <p class="lead">from &pound;20 / year</p>
            <p> 

            We don't sell your data or show adverts because you're our customer, not our product. And because we're working for YOU, we charge a small fee for premium features</p>
            <p>Use the coupon code: LOVESUMMER</p>
            <a href="/payments/" class="btn btn-primary btn-stroke">Upgrade today <i class="fa fa-fw fa-play-circle"></i>
            </a> 
        </div>
        <!-- Ribbon -->
        <div class="ribbon-wrapper">
            <div class="ribbon primary">Special</div>
        </div>
      </div>
    </div>
    {% endifequal %}
 

 


    <!-- SHOPPING LIST --> 
    {% if we_buy %}
    <div class="panel panel-default" id="panelShoppingList">
      <div class="panel-heading">
        <div class="panel-title">
          <i class="fa fa-list"></i> <strong>Shopping List</strong>
      

          <div class="pull-right">
            {% if all_buying_foods|length != 0 %}
              <span class="badge">{{all_buying_foods|length}}</span>
              <span data-target="#searchShopping" data-toggle="collapse" class="innerL">
                <i class="fa fa-search fa-fw"></i>
              </span>
            {% endif %}

            {% if user.is_authenticated %}
              <a data-toggle="collapse" class="label label-primary label-stroke" data-target="#addShopping" rel="tooltip" title="Add to purchased items">
               <i class="fa fa-plus-circle"></i> Add
              </a> 
            {% endif %} 
          </div>
        </div>
      </div>

      <!-- add produce to shoping list --> 
      {% if user.is_authenticated %}
      <div id="addShopping" class="well-sm well clearfix">

            <p class="small text-center">What does {{username}} buy?</p>
         
        <div class="input-group" style="margin: 0 auto;"> 
          <div class='pull-left'>  
            <select id="webuy_select" data-placeholder="Add produce they buy (eg carrots)" style="height:15px; width: 192px; padding: 10px 5px;" multiple class="chosen-select" >
                <option value=""></option> 
               {% for each in all_tags %}
                  <optgroup label={{each.node}}>
                  {% if each.childrens %}
                  {% for eachchild in each.childrens %}
                  <option>{{eachchild.node}}</option>
                  {% endfor %}
                {% else %}
                  <option>{{each.node}}</option>
                {% endif %}
                  </optgroup>
                {% endfor %}
            </select>
          </div>

          <div class="pull-left">
            <span class="input-group-btn">
              <button class="btn btn-inverse btn-sm" id="adfoo_id" rel="tooltip" style="height:35px;" onClick="add_food({{profile_id}}, 'we_buy')" {% if not user.is_authenticated %} title="Please log in to use this feature." {% endif %} > Add</button>
            </span>
          </div>
        </div>       
      </div>
      {% endif %}

      <!-- filter shopping list --> 
      <div class="collapse well-sm well" id="searchShopping">
        <input type="text" class="form-control" id="filterShopping" placeholder="Search... " />
      </div>

      <div class="mCustomScrollbar scroll300">
        <table class="table table-hover table-condensed footable toggle-circle" id="shoppinglistTable" data-filter="#filterShopping" data-filter-text-only="true"> 
        <thead class="hidden">
            <tr> 
              <th data-hide="" data-toggle="true">
                more arrow
              </th> 
              <th data-hide=""  >
                Produce
              </th>
              <th data-hide=" " >
                Tags
              </th>
              <th data-hide="all" >
                Description
              </th> 
              <th data-hide="all">
                Season
              </th>
              <th data-hide="">
                Quantity
              </th> 
              <th data-hide="">
                Search
              </th>
              <th data-hide="all">
                Actions
              </th>
            </tr>
          </thead>
          <tbody id="webuy_foods">
           
            {% include "webuy_foods.html" %}
            
          </tbody>
        </table>
      </div>
 
 
    </div><!-- end panel --> 
    {% endif %}
    <!-- end we_buy -->


 

  </div><!--produce-->
  <div class="tab-pane fade" id="tradeswith">
    

    <!-- buys from / suppliers --> 
    <div class="panel panel-default" id="panelSuppliers">
      <div class="panel-heading">
        <h3 class="panel-title">
          <i class="fa fa-sign-in"></i> <strong>Buys from</strong> <span id="b_con_no" class="normal black">{{b_conn_no}}</span> Suppliers 
        </h3>

        <div class="pull-right" style="margin-top: -18px; font-size: 15px;"> 
          {% if userprof.b_conn_no != 0 %}
            <span data-target="#searchSuppliers" data-toggle="collapse" class="innerL">
              <i class="fa fa-search fa-fw"></i>
            </span>
          {% endif %}

          {% if user.is_authenticated %}
            <a data-toggle="collapse" class="label label-primary label-stroke" data-target="#addSupplier" rel="tooltip" title="Add a supplier">
             <i class="fa fa-plus-circle"></i> Add
            </a> 
          {% endif %} 
        </div>
      </div> 

      <!-- filter -->
      <div class="collapse well-sm well" id="searchSuppliers">
        <input type="text" class="form-control" id="filterSuppliers" placeholder="Filter suppliers" />
      </div>

      <!-- WIKI ADD CONNECTIONS --> 
          {% if user.is_authenticated %}  
          <div id="addSupplier" class="{% if userprof.b_conn_no != 0 %} collapse {% endif %} well-sm well clearfix" style="z-index: 100000;">
            {% if userprof.b_conn_no = 0 %}
              <p class="small">Do you know anyone who supplies {{username}}?</p>
            {% endif %}
            <div class="form-inline"  role="form">
              <div class="form-group"> 
                <div class="hidden" data-toggle="buttons">
                  <label class="" id="li1_conn">
                    <input type="checkbox" name="options" id="option1_conn"> 
                  </label>  
                </div>  
              </div> 
              <div class="form-group"> 
                <div id="stockists_remote" class="form-group  has-feedback">
                  <input class="typeahead  input-sm form-control  " id="new_stockists_typeahead" {% if not user.is_authenticated %} rel="tooltip" title="Please login to use this feature" {% endif %} style="width:310px;" type="text" placeholder="Start typing a supplier..."> 
                  <span class="fa fa-search form-control-feedback"></span> 
                </div>      
              </div>   
            </div>
          </div> 
          {% endif %}
  
      <div  class="mCustomScrollbar scroll300">
        <table class="table table-hover table-condensed footable toggle-circle" id="suppliersTable" data-filter="#filterSuppliers" data-filter-text-only="true"> 
        <thead class="hidden">
            <tr> 
              <th data-hide="" data-toggle="true" data-class="vcenter">
                popover
              </th> 
              <th data-hide=""  >
                Image
              </th>
              <th data-hide=" " data-class="vcenter">
                name
              </th>
              <th data-hide="all" >
                desciption
              </th>
              <th data-hide="" data-class="vcenter">
                tags
              </th> 
              <th data-hide="all">
                banner
              </th> 
              <th data-hide="all">
                vouches
              </th> 
            </tr>
          </thead>

          <tbody id="supplier_connections">
        {% for each in connections %}
        {% if each.relation == "buyer" or each.relation == "both" %}

       {% include "conn_ajax.html" %}
               

          {% endif %}
          {% endfor %}
          </tbody>  
          </table> 

    </div> 
        
    </div>

   <!-- Sells to / Stockists  --> 
    <div class="panel panel-default" id="panelStockists">
      <div class="panel-heading">
        <h3 class="panel-title">
          <i class="fa fa-sign-out"></i> <strong>Sells to </strong> <span id="c_con_no" class="normal black">{{c_conn_no}}</span> Stockists 
        </h3>
        <div class="pull-right" style="margin-top: -18px; font-size: 15px;"> 

          {% if userprof.c_conn_no != 0 %}
          <span data-target="#searchStockists" data-toggle="collapse" class="innerL">
            <i class="fa fa-search fa-fw"></i>
          </span>
          {% endif %}

          {% if user.is_authenticated %}
            <a data-toggle="collapse" class="label label-primary label-stroke" data-target="#addStockist" rel="tooltip" title="Add a stockist">
             <i class="fa fa-plus-circle"></i> Add
            </a> 
          {% endif %} 
        </div>
      </div> 

      <!-- filter -->
      <div class="collapse well-sm well" id="searchStockists">
        <input type="text" class="form-control" id="filterStockists" placeholder="Find a stockist" />
      </div>

      <!-- WIKI ADD CONNECTIONS --> 
          {% if user.is_authenticated %}  
          <div id="addStockist" class="{% if userprof.c_conn_no != 0 %}collapse{% endif %} well-sm well clearfix" style="z-index: 100000;">
            {% if userprof.c_conn_no = 0 %}
              <p class="small">Do you know anyone who sells {{username}} produce?</p>
            {% endif %}
            <div class="form-inline"  role="form">
              <div class="form-group"> 
                <div class="hidden" data-toggle="buttons">
                  <label class="" id="li1_conn">
                    <input type="checkbox" name="options" id="option2_conn"> 
                  </label>  
                </div>  
              </div> 
              <div class="form-group"> 
                <div id="suppliers_remote" class="form-group  has-feedback">
                  <input class="typeahead  input-sm form-control  " id="new_suppliers_typeahead" {% if not user.is_authenticated %} rel="tooltip" title="Please login to use this feature" {% endif %} style="width:310px;" type="text" placeholder="Start typing a stockist..."> 
                  <span class="fa fa-search form-control-feedback"></span> 
                </div>      
              </div>   
            </div>
          </div> 
          {% endif %}
 
        

       <div class="mCustomScrollbar scroll300">
        <table class="table table-hover table-condensed footable toggle-circle" id="stockistsTable" data-filter="#filterStockists" data-filter-text-only="true"> 
        <thead class="hidden">
            <tr> 
              <th data-hide="" data-toggle="true" data-class="vcenter">
                popover
              </th> 
              <th data-hide=""  >
                Image
              </th>
              <th data-hide=" " data-class="vcenter">
                name
              </th>
              <th data-hide="all" >
                desciption
              </th>
              <th data-hide="" data-class="vcenter">
                tags
              </th> 
              <th data-hide="all">
                banner
              </th> 
              <th data-hide="all">
                vouches
              </th> 
            </tr>
          </thead>

          <tbody id="stockist_connections">
        {% for each in connections %}
        {% if each.relation == "seller" or each.relation == "both" %}

       {% include "conn_ajax.html" %}
               

          {% endif %}
          {% endfor %}  
          </tbody>
          </table> 
          </div>

    
 
    </div>
 
  </div><!-- tradeswith --> 
  <div class="tab-pane fade" id="about">
      <!-- GROUPS and organisations -->
<div class="panel panel-default" id="panelOrganisations">
  <div class="panel-heading">
    <h3 class="panel-title">
      <strong>
      <i class="fa fa-certificate"></i> 
      <span id="orgConnNo" class="normal black">{% if userprof.organisation_connection_no != 0 %}{{userprof.organisation_connection_no}}{% endif %}</span> Groups</strong> &amp; organisations
      
      <div class="pull-right">
        {% if user.is_authenticated %}
          <a data-target="#addGroup" class="label label-primary label-stroke" data-toggle="collapse" rel="tooltip" title="Add to a group"><i class="fa fa-plus-circle"></i> Add</a>
        {% endif %}
      </div>

    </h3>
  </div>

  {% if user.is_authenticated %}
  <div id="addGroup" class="{% if userprof.organisation_connection_no != 0 %}collapse{% endif %} well-sm well clearfix">
  {% if userprof.organisation_connection_no = 0 %}
    <p class="small">Is {{username}} a member of any organisations or certifiers?</p>
  {% endif %}
    <div class="form-inline" role="form"> 
      <div id="orgs_remote" class="form-group  has-feedback">
        <input class="typeahead form-control col-sm-12" id="new_orgs_typeahead" {% if not user.is_authenticated %} rel="tooltip" title="Please login to use this feature" {% endif %} style="min-width:350px;" type="text" placeholder="Type the name of a group, organisation, or certifier">
        <span class="fa fa-search form-control-feedback"></span> 
      </div>     
    </div>    
  </div>
  {% endif %}

  {% if user.is_authenticated %}
    {% else %}
      <p class="innerAll"><a href="{% provider_login_url "twitter" process="login" %}" class="">Login</a> or <a href="{% provider_login_url "twitter" process="login" %}" class="">sign up free</a> to see a complete list of groups. </p>
  {% endif %}

  <div class="panel-body groupsGrid" id="groupsGrid">
 
    
    {% for each in organisations %}  
      <div class="groupItem clearfix" id="orgGroupItem{{each.username}}">
        <div class="text-center">
          <a href="/profile/{{each.username}}"><img src="{{each.photo}}" alt="{{each.name}}"
          class="img-thumbnail img-responsive img-circle" style="width:50px; height:50px;" /></a>
          <strong class="clearfix"><a href="/profile/{{each.username}}" class="text-black">{{each.name}}</a></strong> 
        </div>
        <p class='small'>{{each.description|truncatechars:80}}</p>
        {% ifequal profile_id user_id %}
        <button type="button" class="btn btn-danger btn-xs pull-right" aria-hidden="true" onclick="del_org_from_biz( {{profile_id}}, {{each.id}})" title="Remove" rel="tooltip"><i class="fa-trash-o fa"></i></button> 
        {% endifequal %}
      </div>  
    {% endfor %}  
  </div>
</div>

    
    <!-- COMPANY INFORMATION --> 
    <div class="panel panel-default" id="panelCompany">
    <div class="panel-heading">
      <div class="panel-title"><i class="fa fa-legal"></i> <b>Company</b> information
      <!-- if owner, show link to edit -->
      {% if profile_id == user_id %}
      <a href="/editprofile/me" class="small pull-right">Edit</a>
      {% endif %}
      </div>
    </div>
    <div class="panel-body">

      {% if company_num %} 
      <p>
        <b>Company number:</b> <a href="https://www.duedil.com/company/{{company_num}}">{{company_num}}</a>  
      </p>
      {% endif %} 

      <!-- twitter info --> 
      <p><b>Twitter followers</b>: {{followers_count}} </p>
    <!-- 
        <span class="label label-default label-stroke">{{followers_count}}</span> followers
        <i class="fa fa-fw fa-twitter fa-lg" style="color: #35B8EB;"></i>
        follows
        <span class="label label-default label-stroke">{{friends_count}}</span>  
    -->

    </div>
    </div>
    <!-- /COMPANY INFORMATION --> 
  </div><!-- about -->
  <div class="tab-pane fade" id="trade">
     <div class="panel panel-default" id="panelUpdates">
      <div class="panel-heading">
        <div class="panel-title">
          <i class="fa fa-bullhorn"></i> <strong>{% if updates_count != 0 %}{{updates_count}}{% endif %} Marketplace</strong> updates
          {% if profile_id == user_id %}
          &middot;
           <a href="#" data-toggle="collapse" data-target="#newtwitterpost" class="small">New update
           </a>
          {% endif %} 
        </div>
      </div> 

      <div class="panel-body">
        {% if updates_count == 0 %}
        {% if profile_id == user_id %}
          <p></p>

          <p><b>You've not yet said anything in the Marketplace!</b></p>
          <p>You're missing local bargains! What do you want to buy, or sell? Or what would you love help with? </p><p>Thought of something? Then just <a href="#" data-toggle="modal" data-target="#newtwitterpost" class="">say it now</a> and it will show up here, in the activity feed, and be pushed out to local businesses in a regular newsletter. 
           </a></p>
        {% else %}
          <p></p>
          <p>They've not posted any updates yet.</p>

        {% endif %}
  {% endif %}
        {% if user.is_authenticated %}
        {% for eachUpdate in updates %} 
        <div class="update clearfix">
          <div class="">
            <a href="" class="text-inverse"> {{eachUpdate.status|recognise_name|safe}}</a>
          </div>
          <small class="pull-left">
            <a href="/{{username}}/post/{{eachUpdate.tweetuid}}/">  {{eachUpdate.replies_count}} replies</a>
          </small>  
          <small class="pull-right">
            <a href="/{{username}}/post/{{eachUpdate.tweetuid}}/">  {{eachUpdate.time_elapsed}} ago</a>
          </small>  
        </div>
        {% endfor %}  
        {% else %}
          <p class=""><a href="{% provider_login_url "twitter" process="login" %}" class="">Login</a> or <a href="{% provider_login_url "twitter" process="login" %}" class="">sign up free</a> to see updates and activity. </p>
        {% endif %} 
           
      </div> 
 
    </div>

    <!-- DELIVERIES -->
    <div class="panel panel-default" id="panelDeliveries">
      <div class="panel-heading">
        <div class="panel-title">
          <i class="fa fa-truck"></i> <strong>Deliveries</strong>
          <!-- if owner, show link to edit -->
          {% if profile_id == user_id %}
          <a href="/editprofile/me" class="small pull-right">Edit</a>
          {% endif %}
        </div>
      </div> 
      <div class="panel-body">
        {% if deliverables %} 
          {{deliverables|linebreaks}}
        {% else %} 
          Please contact us directly to discuss deliveries.
        {% endif %}

           
      </div> 
 
    </div>




<!-- customers -->
{% if customers|length != 0 %}
<div class="panel panel-default" id="panelCustomers">
  <div class="panel-heading">
    <div class="panel-title">
    <div class="pull-right"> 
      <span class="badge">{{customers|length}}</span>
      <span data-target="#searchProduce" data-toggle="collapse" class="innerL">
        <i class="fa fa-search fa-fw"></i>
      </span>
    </div>
      <i class="fa fa-truck"></i> <strong>Customers</strong>
    </div>
 

  </div> 
  <div class="panel-body">
    {% if user.is_authenticated %}
    {% else %} 
      <p class=""><a href="{% provider_login_url "twitter" process="login" %}" class="">Login</a> or <a href="{% provider_login_url "twitter" process="login" %}" class="">sign up free</a> to see where their customers live. Maybe they'll do home deliveries if there are enough people in your area? </p> 
    {% endif %}

     {% for each in customers %}

        <div class="card card-individual"> 

          <div class="content" style="background:  url('{{each.banner_url}}');">
            <div class="text-center">
              <a href="/profile/{{each.username}}"><img src="{{each.photo}}" alt="{{each.name}}"
              class="img-thumbnail img-responsive" style="width:73px; height:73px;" /></a>

            </div>
            <div class="text"> 
              <h5><a href="/profile/{{each.username}}">{{each.name}}</a> 
              </h5>  
              <p class="small">{{each.description|truncatechars:40}}</p>
            </div>
          </div> 

        </div>
    {% endfor %} 
  </div> 
</div>
{% endif %} 


  </div><!-- trade -->
</div>
 

 


 


  </div> <!-- col 4 -->
</div><!-- row -->

</div>
<!-- /NEW -->

  

    
   
      
     <!-- modal_contact -->
      <div class="modal fade" id="modal_contact" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">Contact {{userinfo.name}}</h4>
            </div>
            <div class="modal-body">
            <div class="container-responsive">
              <div class="row">
                <div class="col-sm-6"> 
                    <div class="widget-body padding-none">
                      <div class="innerAll half">
                        {% if email != '' %}
                        <p class=" margin-none"><i class="fa fa-envelope fa-fw text-muted"></i> 
                        <a href="mailto:{{email}}" target="_blank">
                         {{email}} </a>
                        </p>
                        {% endif %}
                      </div>
                      {% if phone_number %}
                      <div class="border-top innerAll half">
                        <p class=" margin-none"><i class="fa fa-phone fa-fw text-muted"></i>
                          <a href="callto:{{phone_number}}">{{phone_number}}</a>   
                        </p>
                      </div>
                      {% endif %}
                      {% if screen_name != "@" %}
                      <div class="border-top innerAll half">
                        <p class=" margin-none"><i class="fa fa-twitter fa-fw text-muted"></i> 
                          <a href="http://twitter.com/{{screen_name}}"  target="_blank"> {{screen_name}}</a>
                        </p>
                      </div>
                      {% endif %}
                    </div> 
                </div>

                <div class="col-sm-6">
                  {% if loc.lat == -82.8627519 and loc.lon == -135.0 %} 
                  {% else %}
                  <div class="innerAll half">
                   <a href="http://maps.google.com/maps?saddr={{loggedin_coord.lat}},{{loggedin_coord.lon}}&daddr={{loc.lat}},{{loc.lon}}" target="_blank" data-placement="top" data-toggle="tooltip" title="Get directions" class="" style="margin-right:20px;">
                    {{address}}
                  </a>   
                  </div>
                  {% endif %} 

                  <div class="border-top innerAll half">
                      <p class=" margin-none"><i class="fa fa-link fa-fw text-muted"></i> 
                        <a href="{{website_url}}">Visit website</a>
                      </p>

                  </div>
                </div>

                </div><!-- row -->
                <div class="row">
                {% if screen_name != '@' and email != '' %}
                <div class="col-sm-12 contact-form">
                  <form id="contact" method="post" class="form" role="form">
                    <div class="row">
                      <div class="col-xs-6 col-md-6 form-group">
                        <input class="form-control" id="sender_name" name="name" placeholder="Name" type="text" required autofocus value = "{{userinfo.full_name}}"/>
                      </div>
                      <div class="col-xs-6 col-md-6 form-group">
                        <input class="form-control" id="sender_email" name="email" placeholder="Email" type="email" required value = "{{userinfo.email}}" />
                      </div>
                    </div> 

                    <textarea class="form-control" id="email_message" placeholder="Type in your message" rows="5"></textarea>
                    <h6 class="pull-right" id="contact_counter">120 characters remaining</h6>
                     
                  </form>
                </div>
                {% endif %}
              </div>
            </div>
 
   
            </div>
            <div class="modal-footer">  
            {% if screen_name != '@' and email != '' %}
              <button type="button" id="contact_tweet" class="btn btn-info" onclick="post_contact_tweet('{{screen_name}}')"><i class="fa fa-fw fa-twitter"></i> Tweet it</button>
              <button type="button" class="btn btn-success" onclick="send_email('{{email}}')"><i class="fa fa-envelope fa-fw"></i> Email it</button>
              {% endif %}
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->


      <!-- modal_customer -->
      <div class="modal fade" id="modal_tweet_recomm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">Tell others what you have just recommended!</h4>
            </div>
            <div class="modal-body">
               <form accept-charset="UTF-8" action="" method="POST">
                      <textarea id="tweet-recomm" class="form-control counted" name="message" placeholder="Type in your message" rows="5" ></textarea>
                  </form> 
   
            </div>
            <div class="modal-footer"> 
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              {% if user.is_authenticated %}
              <button type="button" class="btn btn-success" data-dismiss="modal" onclick="UpdateStatus('tweet-recomm', 'noappend')">Tweet</button>
              {% else %}
              <button type="button" class="btn btn-success" data-dismiss="modal">Tweet</button>
              {% endif %}
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
 
<a href='' id="trigger_modal_food_detail" class='btn btn-sm btn-info hidden' data-toggle='modal' data-target='#modal_food_detail'  data-container='body'>Trigger Food Detail Modal Hidden</a>
<div class="modal fade" id="modal_food_detail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="food_detail_title">Add details to </h4>
            </div>
            <div class="modal-body">
              <form accept-charset="UTF-8" action="." role="form" method="POST" enctype="multipart/form-data">
               {% csrf_token %}
               <div class="row">
                <div class="col-sm-4" id="photo_upload_container"> 
                  <a href="#" rel="tooltip" title="Change the photo">
                    <img src="" class="img-responsive img-thumbnail" id="food_photo" style="width:100%;height:150px; background: #ccc url('/static/images/upload.gif'); background-size: cover;"> 
                  </a>
                  <!-- show this in another modal? -->
                  <!-- can we use html5 drag and drop to upload? -->
                    <div class="form-group">
                      <label for="food_photo">Upload a photo</label>
                      {{form.food_photo}}
                      {{form.food_name.as_hidden}}
                      {{form.profile_id.as_hidden}}
                {{form.food_tags.as_hidden}}
               {{form.food_duplicate.as_hidden}} 
                    </div>
                  <!-- end code -->
                </div>
                
                <div class="col-sm-8" id="produce_description_container">

                  <div class="form-group">
                    {{form.food_description}}
                  </div>


                  <div class="form-group row">
                    <!-- add weight input --> 
                    <div class="col-xs-6" style="padding-right:0;">
                      {{form.how_much}}
                    <p class="help-block">Weight / vol / size</p>
                    </div>
                    <div class="col-xs-6" style="padding-right:0;"> 
                      {{form.how_often}}
                     <!-- <select id="qtyUnit" class="form-control btn-sm selectpicker">        
                        <option value="">How often</option>   
                        <option value="daily">daily</option>
                        <option value="monthly">monthly</option>
                        <option value="seaonsally">seaonsally</option>
                        <option value="annualy">annualy</option>
                      </select> -->
                    </div>
                  </div>
                  
                  <div class="form-group" id="recommend_main" style="display:none;">
                    <div id="recomm_tags">
                    </div>
                    
                  </div>
                  <div class="form-group">
                  <ul id="myTags">
                    <!-- Existing list items will be laoded here --> 
                  </ul>
                  <p class="help-block small">Use commas to separate tags.</p>
                  
 
                  <div class="form-group"> 
                  <label>Available in the months</label>
                    <table class="availability"> 
                    <tbody><tr>
                      <div class="btn-group btn-sm" data-toggle="buttons">
                      <label class="btn btn-sm btn-default winter">
                        <input type="checkbox" name="option1_month" id="option1_month"> J
                      </label> 
                      <label class="btn  btn-sm btn-default winter">
                        <input type="checkbox" name="option2_month" id="option2_month"> F
                      </label> 
                      <label class="btn  btn-sm btn-default spring">
                        <input type="checkbox" name="option3_month" id="option3_month"> M
                      </label> 
                      <label class="btn  btn-sm btn-default spring">
                        <input type="checkbox" name="option4_month" id="option4_month"> A
                      </label> 
                      <label class="btn btn-sm btn-default spring">
                        <input type="checkbox" name="option5_month" id="option5_month"> M
                      </label> 
                      <label class="btn  btn-sm btn-default summer">
                        <input type="checkbox" name="option6_month" id="option6_month"> J
                      </label> 
                      <label class="btn  btn-sm btn-default summer">
                        <input type="checkbox" name="option7_month" id="option7_month"> J
                      </label> 
                      <label class="btn  btn-sm btn-default summer">
                        <input type="checkbox" name="option8_month" id="option8_month"> A
                      </label> 
                      <label class="btn btn-sm btn-default autumn">
                        <input type="checkbox" name="option9_month" id="option9_month"> S
                      </label> 
                      <label class="btn  btn-sm btn-default autumn">
                        <input type="checkbox" name="option10_month" id="option10_month"> O
                      </label> 
                      <label class="btn  btn-sm btn-default autumn">
                        <input type="checkbox" name="option11_month" id="option11_month"> N
                      </label> 
                      <label class="btn  btn-sm btn-default winter">
                        <input type="checkbox" name="option12_month" id="option12_month"> D
                      </label> 
                </div>  
                    </tr></tbody></table>  
                  </div> 

                </div>
               </div><!-- row -->

               
            </div><!-- modal body -->
            <div class="modal-footer"> 
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              {% if user.is_authenticated %}
              <button type="submit" class="btn btn-success" onClick="var tags =$('#myTags').tagit('assignedTags'); $('#id_food_tags').val(tags);">Save</button>
              {% else %}
              <button type="submit" class="btn btn-success">Save</button>
              {% endif %}
            </div>
            </form>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->


 
    

    
     

{% endblock %}
{% block footer %}
{% include "includes/not_logged_in_modal.html" %}
<script src="/static/js/chosen.jquery.min.js" type="text/javascript"></script> 
<script src="{% static "js/typeahead.min.js" %}"></script>
<script type="text/javascript">
  function show_upload()
  {
    $('#photo_upload_container').css('display',"block");
    $('#produce_description_container').removeClass("col-sm-12");
    $('#produce_description_container').addClass("col-sm-8");
  }

  function hide_upload()
  {
    $('#photo_upload_container').css('display',"none");
    $('#produce_description_container').removeClass("col-sm-8");
    $('#produce_description_container').addClass("col-sm-12");
  }

$( document ).ready(function() {
      $("#myTags").tagit({
          placeholderText: 'Add tags, eg free-range',
          allowSpaces: true
        });
    // food_detail();
    $('#myselect').chosen({create_option: true, skip_no_results: true, create_option_text: 'Add'});
    $('#webuy_select').chosen({create_option: true, skip_no_results: true, create_option_text: 'Add'});
    // chosen on change event
        $('#myselect').chosen().change(function(){
          
        add_food({{profile_id}});
        });
        $('#webuy_select').chosen().change(function(){
        add_food({{profile_id}}, 'we_buy');
        });
        
        $('#myselect').chosen().ready(function(){
          $('.search-field input').attr('style', 'width:300px;height:20px;');
        });

    if (jQuery.contains(document, $('#myselect'))) {    
    document.getElementById("myselect").addEventListener("DOMSubtreeModified", function(e) {
      // Record the occurrence
        var text = $('.create-option').text();
        var word = text.split('"')[1];
        //alert(word);
        // add the word to new collection of unapproved foods
        var data = {useruid: {{profile_id|safe}}, food_name: word, created_by: {{user_id|safe}}};
        ajax_request("addnewfood", 'empty', {data: JSON.stringify(data)}); 
    }, false);
    }

    var remove_from_input = false;
});

// adding organisations to business
$('#orgs_remote').on('click','.tt-suggestion', function(){
    var organisation_id = this.getElementsByClassName('result-name')[0];
    var org_var = $(organisation_id).attr('data-id');
    if(org_var == 'search'){
      $('#my_invite_twitter').click();
    }
  else{
        add_org_to_biz('{{profile_id}}', org_var);
        $('#new_orgs_typeahead').val('');
        $('.tt-hint').val('');
      }
    });
    $('#new_orgs_typeahead').on('blur', function(){
      $('#new_orgs_typeahead').val('');
});

// adding stockists to business

    $('#panelSuppliers').on('click', '.tt-suggestion', function(){
    myvar = this;
    var business_id = this.getElementsByClassName('result-name')[0];
    var buss_var = $(business_id).attr('data-id');
    if(buss_var == 'search'){
      $('#my_invite_twitter').click();
    }
    else{
      third_party_connection('{{profile_id}}', buss_var, 'stockists');
      $('#new_stockists_typeahead').val('');
      $('.tt-hint').val('');
    }
  });


$('#new_stockists_typeahead').on('blur', function(){
  $('#new_stockists_typeahead').val('');
});


$('#panelStockists').on('click', '.tt-suggestion', function(){  
      var business_id = this.getElementsByClassName('result-name')[0];
      var buss_var = $(business_id).attr('data-id');
      if(buss_var == 'search'){
        $('#my_invite_twitter').click();
      }
      else{
        third_party_connection('{{profile_id}}', buss_var, 'suppliers');
        $('#new_suppliers_typeahead').val('');
        $('.tt-hint').val('');
      }
});


$('#new_suppliers_typeahead').on('blur', function(){
  $('#new_suppliers_typeahead').val('');
});


function set_width(){
  $('#buss_chosen_chosen').attr("style", "width:350px;");
}

function get_food_detail(profile_id, food_name, description, food_tags, photo_url, recomm_tags, how_much, how_often, month_list){
    var month_list = jQuery.parseJSON(month_list);
    $("#myTags").tagit("removeAll");
    $('#food_detail_title').text('Add details to '+ food_name);
    var placeholder = "What makes your " + food_name + " special? This is where it's completely fine to show-off! Remember to name any variety names, special techniques, or unique properties - and how it tastes is the most important thing."
    $('#id_food_description').attr('placeholder', placeholder);
    $('#id_food_description').addClass('food_details_counted');
    $('#id_food_description').attr('rows', 5);
    // document.getElementsByName('food_name').value = food_name;
    // document.getElementsByName('profile_id').value = profile_id;
    $('#id_food_name').val(food_name);
    $('#id_profile_id').val(profile_id);
    $('#id_food_description').val(description);
    $('#id_how_much').val(how_much);
    $('.filter-option').text(how_often);
    
    
    for(i=1;i<=12;i++){
      if(parseInt(month_list[i-1])==1){
        if(!($('#option'+ String(i) +'_month').parent().hasClass('active'))){
          $('#option'+ String(i) +'_month').parent().addClass('active');
        }
        $('#option'+ String(i) +'_month').prop('checked', true);
      }
      else{
        $('#option'+ String(i) +'_month').prop('checked', false);  
        if($('#option'+ String(i) +'_month').parent().hasClass('active')){
          $('#option'+ String(i) +'_month').parent().removeClass('active');
        }
      }
    }


    var tags_list = food_tags.split(',');
    for(i=0;i<tags_list.length;i++){
      $("#myTags").tagit('createTag', tags_list[i]);
    }
    $('#food_photo').attr('src', photo_url);
    $(".food_details_counted").charCounter(300,{container: "#counter"});    
    $('#id_food_duplicate').val(photo_url);
    $('#recommend_main').show();
    var recomm_tags_list = recomm_tags.split(',');
    $('#recomm_tags').html('');
    var count = 0;
    for(i=0;i<recomm_tags_list.length;i++){
      
        if(tags_list.indexOf(recomm_tags_list[i]) == -1){
          count = count+1;
          $('#recomm_tags').append('<span class="myowntagit">'+ String(recomm_tags_list[i]) + '</span> ');
        }
    }
    if(count != 0 && $('#recomm_help_text').text() == ''){
    $('#recommend_main').append('<p id="recomm_help_text" class="help-block small">Recommend Tags for your food. Click to add.</p>');}
    $('#recomm_tags').on('click', '.myowntagit', function(e){
        var tag_text =$(this).html();
        $(this).remove();
        $("#myTags").tagit('createTag', tag_text);
    });
   $('#trigger_modal_food_detail').click();

}
    
  </script>

 


     <script src="{% static "js/contact.js" %}"></script>
        <script type="text/javascript">
    map_lat={{ loc.lat }};
    map_lon = {{ loc.lon }};

connections = {{connections_str | safe}};
customers = {{customers_str | safe}};
      var name = "{{userprof.full_name}}";
      var description = "{{userprof.description}}";
      var photo =  "{{userprof.profileimg}}";
      var username = "{{userprof.username}}";
      var type = "{{userprof.type}}".split(',');
      var latitude =  {{userprof.lat}};
          var longitude =  {{userprof.lon}};


      var current_lat = parseFloat(latitude);
      var current_lon = parseFloat(longitude);
  tweetlistener('email_message', 'contact_counter', 'contact_tweet');
      
    </script>
     <script src="{% static "js/business-map.js" %}"></script>



     <script type="text/javascript">



        $(".widget-head ul li").on("click", function(){ 
          id = $(this).attr('id');
          if (id == 'liBuysFrom' || id == 'liSellsTo'){

              $('#connections').addClass('active');
              $('#connections').removeClass('hidden');

              if (id == 'liBuysFrom'){
                $('#option1_conn').attr('checked','checked');
                $('#option2_conn').removeAttr('checked');
                $('#li1_conn').addClass('active');
                $('#li2_conn').removeClass('active');
                
              }
              else{
                $('#option1_conn').removeAttr('checked');
                $('#option2_conn').attr('checked','checked');
                $('#li1_conn').removeClass('active');                
                $('#li2_conn').addClass('active');
              }
          }
          else{
              $('#connections').addClass('hidden');
              $('#connections').removeClass('active');
          }
        });

        
     </script>
     <script type="text/javascript">
      $('#panelSuppliers').on('click',"[data-toggle=popover1]", function () {
        username = $(this).attr('data-title'); 
        if($(this).attr('data-trigger')!="manual")
        {
          return;
        }
        that = this;         
           $.ajax({
              type: "POST",
              url: "/ajax-handler/" + 'get_business_counts',
              data: {'username':username},
              cache: true,
              async:   false,
              success: function(data) {

                $(that).popover({
                  content: get_business_counts_success(data),
                  trigger:"click",
                  placement:"right",
                  html:true
                }).popover("show");
                $(that).attr('data-trigger',"click");
                
              }
          });
      });

     
      function get_business_counts_success(data){
        showfoods ='True'; 
        data = jQuery.parseJSON(data);
        if (data['result']['banner_url'] != ''){          
            mytext = "<img src='" + data['result']['banner_url'] +  "'" + " title='" + data['result']['username'] + "' class='img-responsive'>";
        }
            mytext += "<div class=''><a href='/profile/" + data['result']['username'] + "/' class='black'><strong>" + data['result']['username'] + "</strong></a></div>";
            mytext += "<div class='small innerTB half'>" + data['result']['description'] + "</div><div class='row row-merge border-top'>";
            mytext += "<div class='";
            if (showfoods=='True') {
              mytext += "col-xs-3'>";
            }
            else{
              mytext += "col-xs-6'>";
            }
              
            mytext+= "<a href='' class='innerAll half text-center display-block text-muted' data-original-title='" + data['result']['food_no'] + " foods' rel='tooltip'><i class='fa fa-fw fa fa-cutlery'></i>" + data['result']['food_no'] + "</a>";
            mytext += "</div><!-- number of vouches across all produce -->";

            mytext += "<div class='"; 
            if (showfoods =='True') {
              mytext+= "col-xs-3'>";
            }
            else {
             mytext += "col-xs-6'>";
           }
            mytext += "<a href=''  rel='tooltip' title='" + data['result']['total_vouches'] + " of vouches for all produce'  class='innerAll half text-center display-block text-muted'><i class='fa fa-fw fa-thumbs-o-up'></i>" + data['result']['total_vouches'] + "</a>";
            mytext += "</div> <!-- number of trade connections --> ";
            mytext += "<div class='"; 
            if (showfoods =='True'){
               mytext+= "col-xs-3'>";
            } 
            else{
              mytext += "col-xs-6'>";
            }              
            mytext += "<a href=''  rel='tooltip' title='" + data['result']['trade_conn_no'] +  " of trade connections' class='innerAll half text-center display-block text-muted'><i class='fa fa-fw fa-link'></i>" + data['result']['trade_conn_no'] + "</a></div><!-- number of group membershpis -->  <div class='";

            if (show_foods = 'True') {
             mytext += "col-xs-3'>";
            }
            else{
              mytext += "col-xs-6'>";
            }

            mytext += "<a href=''  rel='tooltip' title='Member of " + data['result']['org_conn_no'] + " groups or organisations'  class='innerAll half text-center display-block text-muted'><i class='fa fa-fw fa-group'></i>" + data['result']['org_conn_no'] + "</a></div> </div>  ";
            return mytext;

          //$("td[data-title='" + data['result']['username'] + "']").attr('data-content', mytext);
      }

      var current_conn_page = {{conn_page_num|safe}};
      var buss_username = '{{buss_user|safe}}';
      {% if request.user.is_authenticated %}
        $(document).ready(function(){
          get_next_page_b_conn(buss_username, current_conn_page + 1);
          get_next_page_c_conn(buss_username,current_conn_page + 1);      
        });
      {% endif %}

var footable_row = '';     
var myfootable = '' ;
control_dict = control_dict;
lines_dic = lines_dic;
$('#suppliersTable').footable().on('click', '.close', function(e) {
        e.preventDefault();
        //get the footable object
        myfootable = $('#suppliersTable').data('footable');

        //get the row we are wanting to delete
        footable_row = $(this).parents('tr:first');
        var content = this.attributes['data-content'].value;
        var content_split = content.split(',');
        var rel_1 = content_split[0];
        var rel_2 = content_split[1];
        conn_handler('close_buy_from', rel_1,rel_2);

});

$('#stockistsTable').footable().on('click', '.close', function(e) {
        e.preventDefault();
        //get the footable object
        myfootable = $('#stockistsTable').data('footable');

        //get the row we are wanting to delete
        footable_row = $(this).parents('tr:first');
        var content = this.attributes['data-content'].value;
        var content_split = content.split(',');
        var rel_1 = content_split[0];
        var rel_2 = content_split[1];
        conn_handler('close_sell_to', rel_1, rel_2);
});
      /*conn_handler('close_buy_from', */


function find_user_in_twitter(){
    u_name = $('#idUserNameStockistOrSupplier').val();
    get_twitter_user_suggestions(u_name);    
}

$('#tradeswith').tabs({
  activate: function( event, ui ) {
      $('.footable').data('footable').redraw();
  }
});

</script>
{% endblock %}
